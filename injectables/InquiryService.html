<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>back-auto-tronic documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">back-auto-tronic documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >InquiryService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/inquiry/inquiry.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAll" >findAll</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAllByStore" >findAllByStore</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOne" >findOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#remove" >remove</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#update" >update</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateInquiryTimeline" >updateInquiryTimeline</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(carSerice: <a href="../injectables/CarService.html" target="_self">CarService</a>, mailSerice: <a href="../injectables/MailService.html" target="_self">MailService</a>, userSerice: <a href="../injectables/UserService.html" target="_self">UserService</a>, inquirySchema: <a href="../classes/Inquiry.html" target="_self">Model&lt;Inquiry&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">src/modules/inquiry/inquiry.service.ts:30</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>carSerice</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CarService.html" target="_self" >CarService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mailSerice</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/MailService.html" target="_self" >MailService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userSerice</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>inquirySchema</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Inquiry.html" target="_self" >Model&lt;Inquiry&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(createInquiryDto: <a href="../classes/CreateInquiryDto.html" target="_self">CreateInquiryDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="55"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:55</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a new inquiry and sends notification emails to the user and dealer.</p>
<p>This function performs the following steps:</p>
<ol>
<li>Creates and saves a new inquiry in the database.</li>
<li>Retrieves the associated car and store information.</li>
<li>Sends notification emails to both the user and the dealer.</li>
</ol>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createInquiryDto</td>
                                            <td>
                                                            <code><a href="../classes/CreateInquiryDto.html" target="_self" >CreateInquiryDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The data transfer object containing the inquiry details.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves when the inquiry is created and emails are sent.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAll"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findAll</b></span>
                        <a href="#findAll"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAll(user: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, status: <a href="../undefineds/InquiryStatus.html" target="_self">InquiryStatus</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="149"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:149</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>This TypeScript function uses aggregation to fetch data from multiple collections and applies
sorting, limiting, and skipping operations.
you want to retrieve. It defaults to &#39;0&#39;, meaning the first page of results.
number of documents to be returned in the result set. In this case, the default value is set to
10, meaning that by default, the function will return a maximum of 10 documents per query.
the associated car and store. The function uses the <code>aggregate</code> method to perform a lookup on the
<code>cars</code> and <code>stores</code> collections based on the <code>car</code> and <code>store</code> fields in the <code>inquirySchema</code>
collection.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>user</td>
                                            <td>
                                                            <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>status</td>
                                            <td>
                                                            <code><a href="../miscellaneous/enumerations.html#InquiryStatus" target="_self" >InquiryStatus</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;0&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The <code>page</code> parameter is used to specify the page number of the results
you want to retrieve. It defaults to &#39;0&#39;, meaning the first page of results.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;10&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The <code>limit</code> parameter in the <code>findAll</code> function specifies the maximum
number of documents to be returned in the result set. In this case, the default value is set to
10, meaning that by default, the function will return a maximum of 10 documents per query.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The <code>findAll</code> function is returning a list of inquiries with additional information about
the associated car and store. The function uses the <code>aggregate</code> method to perform a lookup on the
<code>cars</code> and <code>stores</code> collections based on the <code>car</code> and <code>store</code> fields in the <code>inquirySchema</code>
collection.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAllByStore"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findAllByStore</b></span>
                        <a href="#findAllByStore"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAllByStore(id: Types.ObjectId, status: <a href="../undefineds/StoreStatus.html" target="_self">StoreStatus</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="218"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:218</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>This TypeScript function asynchronously finds all inquiries by store ID, aggregates data from
multiple collections, and applies projection and sorting operations.
inquiries.
retrieve. It is set to a default value of &#39;0&#39;, which means the first page of results will be
returned if no specific page is provided.
maximum number of documents to be returned in the result set. In this case, the default value for
<code>limit</code> is set to 10, meaning that by default, the function will return a maximum of 10 documents.
match the provided store ID. The function uses the <code>inquirySchema</code> model and performs an
aggregation query that includes a lookup to the &quot;cars&quot; collection to retrieve additional
information about the cars associated with the inquiries. The query projects specific fields from
the cars collection, sorts the images, and limits the results to one</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The <code>id</code> parameter is the ObjectId of the store for which you want to find all
inquiries.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>status</td>
                                            <td>
                                                            <code><a href="../miscellaneous/enumerations.html#StoreStatus" target="_self" >StoreStatus</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;0&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The <code>page</code> parameter is used to specify the page number of results to
retrieve. It is set to a default value of &#39;0&#39;, which means the first page of results will be
returned if no specific page is provided.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;10&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The <code>limit</code> parameter in the <code>findAllByStore</code> function specifies the
maximum number of documents to be returned in the result set. In this case, the default value for
<code>limit</code> is set to 10, meaning that by default, the function will return a maximum of 10 documents.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The function <code>findAllByStore</code> is returning a list of inquiries from the database that
match the provided store ID. The function uses the <code>inquirySchema</code> model and performs an
aggregation query that includes a lookup to the &quot;cars&quot; collection to retrieve additional
information about the cars associated with the inquiries. The query projects specific fields from
the cars collection, sorts the images, and limits the results to one</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOne"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findOne</b></span>
                        <a href="#findOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOne(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="269"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:269</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves a single inquiry by its ID with populated timeline user information.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     The returned document excludes postal_code, store, updatedAt, and active fields.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the inquiry to retrieve.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the found inquiry document with populated timeline user information.
The returned document excludes postal_code, store, updatedAt, and active fields.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="remove"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>remove</b></span>
                        <a href="#remove"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>remove(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="317"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:317</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Removes an inquiry from the database by its ID.</p>
<p>This function deletes a single inquiry document from the database based on the provided ID.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The unique identifier of the inquiry to be removed.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../classes/Inquiry.html" target="_self" >Promise&lt;Inquiry | null&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves to the deleted inquiry document, or null if no document was found with the given ID.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="update"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>update</b></span>
                        <a href="#update"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>update(id: Types.ObjectId, updateStatusInquiryDto: <a href="../classes/UpdateStatusInquiryDto.html" target="_self">UpdateStatusInquiryDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="287"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:287</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates an inquiry&#39;s status in the database.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the inquiry to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateStatusInquiryDto</td>
                                            <td>
                                                            <code><a href="../classes/UpdateStatusInquiryDto.html" target="_self" >UpdateStatusInquiryDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Data transfer object containing the updated status information.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the updated inquiry document, or null if no document was found with the given ID.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateInquiryTimeline"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateInquiryTimeline</b></span>
                        <a href="#updateInquiryTimeline"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateInquiryTimeline(id: Types.ObjectId, manageInquiryStatusDto: <a href="../classes/ManageInquiryStatusDto.html" target="_self">ManageInquiryStatusDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="302"
                                    class="link-to-prism">src/modules/inquiry/inquiry.service.ts:302</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the status and timeline of an inquiry.</p>
<p>This function performs two operations:</p>
<ol>
<li>Updates the status of the inquiry.</li>
<li>Adds a new entry to the inquiry&#39;s timeline.</li>
</ol>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the inquiry to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>manageInquiryStatusDto</td>
                                            <td>
                                                            <code><a href="../classes/ManageInquiryStatusDto.html" target="_self" >ManageInquiryStatusDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The DTO containing the new status and timeline information.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves when both update operations are complete.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@nestjs/common&#x27;;
import { CreateInquiryDto } from &#x27;./dto/create-inquiry.dto&#x27;;
// import { UpdateInquiryDto } from &#x27;./dto/update-inquiry.dto&#x27;;
import { UpdateStatusInquiryDto } from &#x27;./dto/update-status-inquiry.dto&#x27;;

// mongoose
import { Inquiry, InquiryStatus } from &#x27;./schema/inquiry.schema&#x27;;
import { InjectModel } from &#x27;@nestjs/mongoose&#x27;;
import { Model, Types } from &#x27;mongoose&#x27;;

// mail service
import { MailService } from &#x27;../../utilities/services/mail/mail.service&#x27;;

// fetch car info
import { CarService } from &#x27;../car/car.service&#x27;;
import { Media } from &#x27;../car/schema/car.schema&#x27;;
import { Store, StoreStatus } from &#x27;../store/schema/store.schema&#x27;;
import { config } from &#x27;../../utilities/config&#x27;;

// dayjs
import * as dayjs from &#x27;dayjs&#x27;;
import * as utc from &#x27;dayjs/plugin/utc&#x27;;
import * as timezone from &#x27;dayjs/plugin/timezone&#x27;;
import { ICurrentUser } from &#x27;../user/decorator/current-user.decorator&#x27;;
import { UserRole } from &#x27;../user/schema/user.schema&#x27;;
import { UserService } from &#x27;../user/user.service&#x27;;
import { ManageInquiryStatusDto } from &#x27;./dto/manage-inquiry-status.dto&#x27;;

@Injectable()
export class InquiryService {

  constructor(
    private readonly carSerice: CarService,
    private readonly mailSerice: MailService,
    private readonly userSerice: UserService,
    @InjectModel(Inquiry.name) private inquirySchema: Model&lt;Inquiry&gt;
  ) {
    dayjs.extend(utc);
    dayjs.extend(timezone);
  }

  /**
 * Creates a new inquiry and sends notification emails to the user and dealer.
 * 
 * This function performs the following steps:
 * 1. Creates and saves a new inquiry in the database.
 * 2. Retrieves the associated car and store information.
 * 3. Sends notification emails to both the user and the dealer.
 * 
 * @param {CreateInquiryDto} createInquiryDto - The data transfer object containing the inquiry details.
 * @returns {Promise&lt;void&gt;} A promise that resolves when the inquiry is created and emails are sent.
 * 
 * @throws {Error} If there&#x27;s an issue creating the inquiry or sending emails.
 */
  async create(createInquiryDto: CreateInquiryDto): Promise&lt;void&gt; {

    // add inquiry data
    const createdInquiry &#x3D; new this.inquirySchema(createInquiryDto);
    createdInquiry.timeline &#x3D; [{
      status: InquiryStatus.new,
      note: createInquiryDto.message,
      user: null
    }];
    await createdInquiry.save();

    const car &#x3D; await this.carSerice.findOneCarForUpdateOrViewByID(createInquiryDto.car as Types.ObjectId);
    const carImage &#x3D; car.images.sort((a: Media, b: Media) &#x3D;&gt; a.position &gt; b.position ? 1 : -1)[0];
    const store &#x3D; car.store as Store;
    if (createInquiryDto.type &#x3D;&#x3D;&#x3D; &#x27;contact&#x27;) {
      // send mail to user
      const mailClient &#x3D; {
        to: createInquiryDto.email,
        from: &#x27;akshay@mechatronic-group.com&#x27;, // Fill it with your validated email on SendGrid account
        templateId: &#x27;d-56846d49e900496883c57af5f1d91640&#x27;,
        dynamicTemplateData: {
          src: carImage.url,
          dealer: store.name,
          phone: &#x60;+1${store.phone}&#x60;,
          name: car.name,
          alias: &#x60;${config.FRONTEND_URL}dealer/${store.alias}&#x60;
        },
      };
      await this.mailSerice.send(mailClient);

      // send mail to dealer
      const mailDealer &#x3D; {
        to: store.email,
        from: &#x27;akshay@mechatronic-group.com&#x27;, // Fill it with your validated email on SendGrid account
        templateId: &#x27;d-5f83966e5d294fea8e62bfa9060d68ab&#x27;,
        dynamicTemplateData: {
          src: carImage.url,
          name: car.name,
          username: createInquiryDto.username,
          phone: &#x60;+1${createInquiryDto.phone}&#x60;,
          email: createInquiryDto.email,
          message: createInquiryDto.message
        },
      };
      await this.mailSerice.send(mailDealer);
    } else {
      // send mail to user
      const mailClient &#x3D; {
        to: createInquiryDto.email,
        from: &#x27;akshay@mechatronic-group.com&#x27;,
        templateId: &#x27;d-5e0977894f2e41948fe5a4c1f8325324&#x27;,
        dynamicTemplateData: {
          src: carImage.url,
          dealer: store.name,
          date: dayjs(createInquiryDto.date).tz(dayjs.tz.guess(), true).format(&#x27;DD/MM/YYYY hh:mm A&#x27;),
          phone: &#x60;+1${store.phone}&#x60;,
          name: car.name,
          alias: &#x60;${config.FRONTEND_URL}dealer/${store.alias}&#x60;
        },
      };
      await this.mailSerice.send(mailClient);

      // send mail to dealer
      const mailDealer &#x3D; {
        to: store.email,
        from: &#x27;akshay@mechatronic-group.com&#x27;,
        templateId: &#x27;d-b0e879c5c0934dde9bf5606fbbf41e3e&#x27;,
        dynamicTemplateData: {
          src: carImage.url,
          name: car.name,
          date: dayjs(createInquiryDto.date).tz(dayjs.tz.guess(), true).format(&#x27;DD/MM/YYYY hh:mm A&#x27;),
          username: createInquiryDto.username,
          phone: &#x60;+1${createInquiryDto.phone}&#x60;,
          email: createInquiryDto.email,
          message: createInquiryDto.message
        },
      };
      await this.mailSerice.send(mailDealer);
    }
  }

  /**
   * This TypeScript function uses aggregation to fetch data from multiple collections and applies
   * sorting, limiting, and skipping operations.
   * @param {string} [page&#x3D;0] - The &#x60;page&#x60; parameter is used to specify the page number of the results
   * you want to retrieve. It defaults to &#x27;0&#x27;, meaning the first page of results.
   * @param {string} [limit&#x3D;10] - The &#x60;limit&#x60; parameter in the &#x60;findAll&#x60; function specifies the maximum
   * number of documents to be returned in the result set. In this case, the default value is set to
   * 10, meaning that by default, the function will return a maximum of 10 documents per query.
   * @returns The &#x60;findAll&#x60; function is returning a list of inquiries with additional information about
   * the associated car and store. The function uses the &#x60;aggregate&#x60; method to perform a lookup on the
   * &#x60;cars&#x60; and &#x60;stores&#x60; collections based on the &#x60;car&#x60; and &#x60;store&#x60; fields in the &#x60;inquirySchema&#x60;
   * collection.
   */
  async findAll(user: ICurrentUser, status: InquiryStatus, page: string &#x3D; &#x27;0&#x27;, limit: string &#x3D; &#x27;10&#x27;) {
    const arrUserRoleFilter &#x3D; [];
    if (user.role &#x3D;&#x3D;&#x3D; UserRole.Admin) {
      const userStores &#x3D; (await this.userSerice.findByID(user._id)).store;
      arrUserRoleFilter.push({ $match: { store: { $in: userStores } } });
    }
    return await this.inquirySchema.aggregate([
      ...arrUserRoleFilter,
      { $match: { status } },
      {
        $lookup: {
          from: &quot;cars&quot;,
          localField: &quot;car&quot;,
          foreignField: &quot;_id&quot;,
          as: &quot;car&quot;,
          pipeline: [
            { $unwind: &#x27;$images&#x27; },
            { $sort: { &#x27;images.position&#x27;: 1 } },
            { $project: { &#x27;images&#x27;: 1, name: 1, vin_number: 1 } },
            { $limit: 1 }
          ],
        },
      },
      {
        $lookup: {
          from: &quot;stores&quot;,
          localField: &quot;store&quot;,
          foreignField: &quot;_id&quot;,
          as: &quot;store&quot;,
          pipeline: [
            { $project: { logo: 1, name: 1 } },
          ],
        },
      },
      {
        $lookup: {
          from: &quot;users&quot;,
          localField: &quot;user&quot;,
          foreignField: &quot;_id&quot;,
          as: &quot;user&quot;,
          pipeline: [
            { $project: { username: 1 } },
          ],
        },
      }
    ])
      .sort({ createdAt: -1 })
      .limit(parseInt(limit))
      .skip(parseInt(page) * parseInt(limit))
      .exec();
  }

  /**
   * This TypeScript function asynchronously finds all inquiries by store ID, aggregates data from
   * multiple collections, and applies projection and sorting operations.
   * @param id - The &#x60;id&#x60; parameter is the ObjectId of the store for which you want to find all
   * inquiries.
   * @param {string} [page&#x3D;0] - The &#x60;page&#x60; parameter is used to specify the page number of results to
   * retrieve. It is set to a default value of &#x27;0&#x27;, which means the first page of results will be
   * returned if no specific page is provided.
   * @param {string} [limit&#x3D;10] - The &#x60;limit&#x60; parameter in the &#x60;findAllByStore&#x60; function specifies the
   * maximum number of documents to be returned in the result set. In this case, the default value for
   * &#x60;limit&#x60; is set to 10, meaning that by default, the function will return a maximum of 10 documents.
   * @returns The function &#x60;findAllByStore&#x60; is returning a list of inquiries from the database that
   * match the provided store ID. The function uses the &#x60;inquirySchema&#x60; model and performs an
   * aggregation query that includes a lookup to the &quot;cars&quot; collection to retrieve additional
   * information about the cars associated with the inquiries. The query projects specific fields from
   * the cars collection, sorts the images, and limits the results to one
   */
  async findAllByStore(id: Types.ObjectId, status: StoreStatus, page: string &#x3D; &#x27;0&#x27;, limit: string &#x3D; &#x27;10&#x27;) {

    const data &#x3D; await this.inquirySchema.aggregate([
      { $match: { store: new Types.ObjectId(id), status } },
      {
        $lookup: {
          from: &quot;cars&quot;,
          localField: &quot;car&quot;,
          foreignField: &quot;_id&quot;,
          as: &quot;car&quot;,
          pipeline: [
            { $unwind: &#x27;$images&#x27; },
            { $sort: { &#x27;images.position&#x27;: 1 } },
            { $project: { &#x27;images&#x27;: 1, name: 1, vin_number: 1 } },
            { $limit: 1 }
          ],
        }
      },
      {
        $project: {
          postal_code: 0,
          store: 0,
          updatedAt: 0,
          active: 0
        }
      }
    ])
      .sort({ createdAt: -1 })
      .limit(parseInt(limit))
      .skip(parseInt(page) * parseInt(limit))
      .exec();

    const count &#x3D; await this.inquirySchema.aggregate([
      { $match: { store: new Types.ObjectId(id) } },
      {
        $group: {
          _id: &#x27;$status&#x27;,
          count: { $sum: 1 }
        }
      }
    ]);
    return { data, count };
  }

  /**
   * Retrieves a single inquiry by its ID with populated timeline user information.
   * 
   * @param id - The ObjectId of the inquiry to retrieve.
   * @returns A Promise that resolves to the found inquiry document with populated timeline user information.
   *          The returned document excludes postal_code, store, updatedAt, and active fields.
   */
  async findOne(id: Types.ObjectId) {
    return await this.inquirySchema.findById(id)
      .populate(&#x27;timeline.user&#x27;, { username: 1, role: 1, _id: 0 })
      .select({
        postal_code: 0,
        store: 0,
        updatedAt: 0,
        active: 0
      }).exec();
  }

  /**
   * Updates an inquiry&#x27;s status in the database.
   *
   * @param id - The ObjectId of the inquiry to be updated.
   * @param updateStatusInquiryDto - Data transfer object containing the updated status information.
   * @returns A Promise that resolves to the updated inquiry document, or null if no document was found with the given ID.
   */
  async update(id: Types.ObjectId, updateStatusInquiryDto: UpdateStatusInquiryDto) {
    return await this.inquirySchema.findByIdAndUpdate(id, { $set: updateStatusInquiryDto });
  }

  /**
   * Updates the status and timeline of an inquiry.
   * 
   * This function performs two operations:
   * 1. Updates the status of the inquiry.
   * 2. Adds a new entry to the inquiry&#x27;s timeline.
   *
   * @param id - The ObjectId of the inquiry to be updated.
   * @param manageInquiryStatusDto - The DTO containing the new status and timeline information.
   * @returns A Promise that resolves when both update operations are complete.
   */
  async updateInquiryTimeline(id: Types.ObjectId, manageInquiryStatusDto: ManageInquiryStatusDto): Promise&lt;void&gt; {
    // update status
    await this.inquirySchema.findByIdAndUpdate(id, { status: manageInquiryStatusDto.status });
    // add timeline
    await this.inquirySchema.findByIdAndUpdate(id, { $push: { timeline: manageInquiryStatusDto } });
  }

  /**
   * Removes an inquiry from the database by its ID.
   * 
   * This function deletes a single inquiry document from the database based on the provided ID.
   * 
   * @param {Types.ObjectId} id - The unique identifier of the inquiry to be removed.
   * @returns {Promise&lt;Inquiry | null&gt;} A promise that resolves to the deleted inquiry document, or null if no document was found with the given ID.
   */
  async remove(id: Types.ObjectId): Promise&lt;Inquiry | null&gt; {
    return await this.inquirySchema.findByIdAndDelete(id);
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'InquiryService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
