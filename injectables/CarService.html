<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>back-auto-tronic documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">back-auto-tronic documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >CarService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/car/car.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#channelWrapper" >channelWrapper</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#changeAllInternally" >changeAllInternally</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#countCarByStore" >countCarByStore</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#countCarByStoreID" >countCarByStoreID</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#countCarByUserID" >countCarByUserID</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createByQueue" >createByQueue</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createMediaUploadURL" >createMediaUploadURL</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAll" >findAll</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAllCarByAdminStore" >findAllCarByAdminStore</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAllCarByFilterForMail" >findAllCarByFilterForMail</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarByDealerORUserID" >findCarByDealerORUserID</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarByStore" >findCarByStore</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarByUser" >findCarByUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarForClient" >findCarForClient</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarForClientByFilter" >findCarForClientByFilter</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findCarForClientByStore" >findCarForClientByStore</a>
                            </li>
                            <li>
                                <a href="#findOneCarByID" >findOneCarByID</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneCarForUpdateOrViewByID" >findOneCarForUpdateOrViewByID</a>
                            </li>
                            <li>
                                <a href="#getFilterToMongoDBFormat" >getFilterToMongoDBFormat</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#increaseCarViewCount" >increaseCarViewCount</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#manageCarMedia" >manageCarMedia</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#manageFavoriteAdvertisement" >manageFavoriteAdvertisement</a>
                            </li>
                            <li>
                                <a href="#randomDate" >randomDate</a>
                            </li>
                            <li>
                                <a href="#refCarSchema" >refCarSchema</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#remove" >remove</a>
                            </li>
                            <li>
                                <a href="#removeWhiteCharacters" >removeWhiteCharacters</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#scrapCarAddData" >scrapCarAddData</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#scrapCarAddDataStatic" >scrapCarAddDataStatic</a>
                            </li>
                            <li>
                                <a href="#sleepDelay" >sleepDelay</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#update" >update</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateAllCount" >updateAllCount</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateByQueue" >updateByQueue</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateCarMedia" >updateCarMedia</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateCarMediaPosition" >updateCarMediaPosition</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateDataTrim" >updateDataTrim</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateStatus" >updateStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#verifyVINNumber" >verifyVINNumber</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(userService: <a href="../injectables/UserService.html" target="_self">UserService</a>, httpService: HttpService, awsS3Service: <a href="../injectables/AwsS3Service.html" target="_self">AwsS3Service</a>, filterService: <a href="../injectables/FilterService.html" target="_self">FilterService</a>, carSchema: <a href="../classes/Car.html" target="_self">Model&lt;Car&gt;</a>, redisService: <a href="../injectables/RedisService.html" target="_self">RedisService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="56" class="link-to-prism">src/modules/car/car.service.ts:56</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>httpService</td>
                                                  
                                                        <td>
                                                                    <code>HttpService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>awsS3Service</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AwsS3Service.html" target="_self" >AwsS3Service</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>filterService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/FilterService.html" target="_self" >FilterService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>carSchema</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Car.html" target="_self" >Model&lt;Car&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>redisService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/RedisService.html" target="_self" >RedisService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="changeAllInternally"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>changeAllInternally</b></span>
                        <a href="#changeAllInternally"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>changeAllInternally()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="577"
                                    class="link-to-prism">src/modules/car/car.service.ts:577</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates all car records internally by standardizing their attribute values.</p>
<p>This function retrieves all filters and cars from the database, then iterates through each car
(starting from the 11th car) to update its attributes based on predefined filter values.
It standardizes the values for color, exterior color, drivetrain, transmission, body type,
and fuel type. If a matching value is not found, it sets the attribute to &#39;unknown&#39;.
After updating each car, it applies a delay of 1 second before processing the next car.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves when all cars have been updated.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="countCarByStore"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>countCarByStore</b></span>
                        <a href="#countCarByStore"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>countCarByStore(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1249"
                                    class="link-to-prism">src/modules/car/car.service.ts:1249</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Counts the number of cars associated with all stores of a given user.</p>
<p>This function first retrieves all stores associated with the user identified by the given ID.
It then counts the number of car documents in the database that are associated with any of these stores.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the user whose stores&#39; cars are to be counted.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the number of cars associated with all stores of the specified user.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="countCarByStoreID"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>countCarByStoreID</b></span>
                        <a href="#countCarByStoreID"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>countCarByStoreID(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1221"
                                    class="link-to-prism">src/modules/car/car.service.ts:1221</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Counts the number of cars associated with a specific store.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the store to count cars for.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the number of cars associated with the specified store.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="countCarByUserID"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>countCarByUserID</b></span>
                        <a href="#countCarByUserID"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>countCarByUserID(userId: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1235"
                                    class="link-to-prism">src/modules/car/car.service.ts:1235</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Counts the number of cars created by a specific user.</p>
<p>This function queries the database to count all car documents
that were created by the user with the given ID.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the user whose cars are to be counted.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the number of cars created by the specified user.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(createCar: <a href="../classes/Car.html" target="_self">Car</a>, user: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="100"
                                    class="link-to-prism">src/modules/car/car.service.ts:100</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a new car advertisement and adds it to a queue for processing.</p>
<p>This function generates a unique ID for the car, sets it as the stock number,
assigns the creator, and then sends the car data to a queue for further processing.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createCar</td>
                                            <td>
                                                            <code><a href="../classes/Car.html" target="_self" >Car</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The car object containing all the details of the car to be advertised.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>user</td>
                                            <td>
                                                            <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The current user object, containing information about the user creating the advertisement.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the generated ID (stock number) of the created car advertisement.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createByQueue"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>createByQueue</b></span>
                        <a href="#createByQueue"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createByQueue(car: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="655"
                                    class="link-to-prism">src/modules/car/car.service.ts:655</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a new car entry in the database and updates the car count in Redis.
This function is designed to be used in a queue-based system for processing car creations.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>car</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An object containing the car details to be saved in the database.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the saved car document.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createMediaUploadURL"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>createMediaUploadURL</b></span>
                        <a href="#createMediaUploadURL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createMediaUploadURL(key: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, type: <a href="../undefineds/MediaType.html" target="_self">MediaType</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="679"
                                    class="link-to-prism">src/modules/car/car.service.ts:679</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a pre-signed URL for uploading media to AWS S3.</p>
<p>This function generates a URL that allows for direct upload of media files
to the specified S3 bucket without requiring AWS credentials in the client-side code.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>key</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The unique identifier for the file in the S3 bucket.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>type</td>
                                            <td>
                                                            <code><a href="../miscellaneous/enumerations.html#MediaType" target="_self" >MediaType</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The type of media being uploaded (e.g., image, video).</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the pre-signed URL for uploading.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAll"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findAll</b></span>
                        <a href="#findAll"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAll(page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="758"
                                    class="link-to-prism">src/modules/car/car.service.ts:758</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves a paginated list of all cars from the database.</p>
<p>This function queries the car schema, applies pagination, and excludes
the &#39;createdAt&#39; and &#39;updatedAt&#39; fields from the results.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an array of car documents.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAllCarByAdminStore"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findAllCarByAdminStore</b></span>
                        <a href="#findAllCarByAdminStore"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAllCarByAdminStore(userId: Types.ObjectId, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="774"
                                    class="link-to-prism">src/modules/car/car.service.ts:774</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars associated with stores managed by an admin user.</p>
<p>This function first finds the stores associated with the given user ID,
then retrieves cars that belong to these stores. The results are paginated.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     If no stores are found for the user, it returns an empty array.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The ObjectId of the admin user.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an array of car documents associated with the admin&#39;s stores.
If no stores are found for the user, it returns an empty array.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAllCarByFilterForMail"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findAllCarByFilterForMail</b></span>
                        <a href="#findAllCarByFilterForMail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAllCarByFilterForMail(seachFilters: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, code: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1091"
                                    class="link-to-prism">src/modules/car/car.service.ts:1091</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Finds all cars matching the specified filters for email notifications.</p>
<p>This function processes search filters, applies geolocation-based filtering,
and retrieves cars created within the last 24 hours. It also formats the
result data for email presentation.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                  Each object should have &#39;name&#39; and &#39;value&#39; properties.
     contains filtered details including name, odometer, asking price,
     a thumbnail image URL, and a link to view more details.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>seachFilters</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An array of filter objects containing search criteria.
Each object should have &#39;name&#39; and &#39;value&#39; properties.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>code</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>A string representing the location code for geolocation lookup.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an array of car objects. Each car object
contains filtered details including name, odometer, asking price,
a thumbnail image URL, and a link to view more details.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarByDealerORUserID"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarByDealerORUserID</b></span>
                        <a href="#findCarByDealerORUserID"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarByDealerORUserID(user: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, dealerOrUserId: Types.ObjectId, status: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1183"
                                    class="link-to-prism">src/modules/car/car.service.ts:1183</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars associated with a dealer or user, filtered by status and paginated.</p>
<p>This function searches for cars based on the user&#39;s role (dealer or regular user),
the specified status, and applies pagination. It also filters out cars created
within the last 5 minutes.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     - data: An array of car documents matching the criteria.
     - count: The total number of matching documents.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>user</td>
                                            <td>
                                                            <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The current user object containing role information.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>dealerOrUserId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The ObjectId of the dealer or user to find cars for.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>status</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The status of the cars to retrieve.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination (0-indexed). Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise resolving to an object containing:</p>
<ul>
<li>data: An array of car documents matching the criteria.</li>
<li>count: The total number of matching documents.</li>
</ul>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarByStore"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarByStore</b></span>
                        <a href="#findCarByStore"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarByStore(storeId: Types.ObjectId, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, list: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1286"
                                    class="link-to-prism">src/modules/car/car.service.ts:1286</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars associated with a specific store, with pagination.</p>
<p>This function queries the database for cars linked to the given store ID,
applying pagination based on the provided page number and items per page.
It also returns the total count of cars associated with the store.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     - data: An array of car documents associated with the store, paginated.
     - total: The total count of cars associated with the store.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>storeId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The ObjectId of the store whose cars are to be retrieved.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination, starting from 0. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>list</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an object containing:</p>
<ul>
<li>data: An array of car documents associated with the store, paginated.</li>
<li>total: The total count of cars associated with the store.</li>
</ul>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarByUser"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarByUser</b></span>
                        <a href="#findCarByUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarByUser(id: Types.ObjectId, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, list: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1268"
                                    class="link-to-prism">src/modules/car/car.service.ts:1268</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars associated with a specific user, with pagination.</p>
<p>This function queries the database for cars linked to the given user ID,
applying pagination based on the provided page number and items per page.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     paginated according to the specified page and list parameters.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The ObjectId of the user whose cars are to be retrieved.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination, starting from 0. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>list</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an array of car documents associated with the user,
paginated according to the specified page and list parameters.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarForClient"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarForClient</b></span>
                        <a href="#findCarForClient"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarForClient(page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="795"
                                    class="link-to-prism">src/modules/car/car.service.ts:795</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars for client display with associated store and user information.</p>
<p>This function performs an aggregation pipeline to fetch car data along with related
store and user details. It includes pagination and sorting by creation date.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     and user information, paginated and sorted by creation date in descending order.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination, starting from 0. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>15</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 15.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an array of car documents with associated store 
and user information, paginated and sorted by creation date in descending order.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarForClientByFilter"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarForClientByFilter</b></span>
                        <a href="#findCarForClientByFilter"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarForClientByFilter(createUserFilterDto: <a href="../classes/CreateUserFilterDto.html" target="_self">CreateUserFilterDto</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, list: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="845"
                                    class="link-to-prism">src/modules/car/car.service.ts:845</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars for clients based on specified filters and pagination parameters.</p>
<p>This function performs a complex aggregation to fetch car data along with associated store and user information.
It applies geospatial queries, filters, and lookups to retrieve relevant car listings.
The function also calculates filter counts for dynamic filtering options.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     - data: An array of car documents matching the filter criteria.
     - total: The total count of cars matching the filter criteria.
     - filters: An array of filter objects with counts for each filter option.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createUserFilterDto</td>
                                            <td>
                                                            <code><a href="../classes/CreateUserFilterDto.html" target="_self" >CreateUserFilterDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>An object containing filter criteria including location and other car attributes.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;0&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination. Defaults to &#39;0&#39;.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>list</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;15&#x27;</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to &#39;15&#39;.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an object containing:</p>
<ul>
<li>data: An array of car documents matching the filter criteria.</li>
<li>total: The total count of cars matching the filter criteria.</li>
<li>filters: An array of filter objects with counts for each filter option.</li>
</ul>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findCarForClientByStore"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findCarForClientByStore</b></span>
                        <a href="#findCarForClientByStore"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findCarForClientByStore(findCarStoreDTO: <a href="../classes/FindCarStoreDTO.html" target="_self">FindCarStoreDTO</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1203"
                                    class="link-to-prism">src/modules/car/car.service.ts:1203</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves cars for client display based on store-specific filters and pagination.</p>
<p>This function searches for cars using the provided store filters, applies pagination,
and returns both the matching car data and the total count of matching cars.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     - data: An array of car documents matching the search criteria.
     - total: The total count of cars matching the search criteria.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>findCarStoreDTO</td>
                                            <td>
                                                            <code><a href="../classes/FindCarStoreDTO.html" target="_self" >FindCarStoreDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>Data transfer object containing store-specific search criteria.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The page number for pagination, starting from 0. Defaults to 0.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of items per page. Defaults to 10.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an object containing:</p>
<ul>
<li>data: An array of car documents matching the search criteria.</li>
<li>total: The total count of cars matching the search criteria.</li>
</ul>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneCarByID"></a>
                    <span class="name">
                        <span ><b>findOneCarByID</b></span>
                        <a href="#findOneCarByID"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>findOneCarByID(carId: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1317"
                                    class="link-to-prism">src/modules/car/car.service.ts:1317</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves a single car document by its ID with specific fields and populated related data.</p>
<p>This function fetches a car document, excluding certain fields and populating
related user and store information. It&#39;s useful for retrieving detailed car
information for display purposes.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     The returned document excludes createdAt, updatedAt, user._id, createdBy, and active fields.
     It includes populated user data (address, location, phone) and store data
     (including remote_services and award image).</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car to retrieve.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the car document with populated user and store information.
The returned document excludes createdAt, updatedAt, user._id, createdBy, and active fields.
It includes populated user data (address, location, phone) and store data
(including remote_services and award image).</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneCarForUpdateOrViewByID"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findOneCarForUpdateOrViewByID</b></span>
                        <a href="#findOneCarForUpdateOrViewByID"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneCarForUpdateOrViewByID(carId: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1300"
                                    class="link-to-prism">src/modules/car/car.service.ts:1300</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves a single car document by its ID, populating the associated store information.
This function is used for updating or viewing detailed car information.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     Returns null if no car is found with the given ID.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car to retrieve.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the car document with populated store information.
Returns null if no car is found with the given ID.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFilterToMongoDBFormat"></a>
                    <span class="name">
                        <span ><b>getFilterToMongoDBFormat</b></span>
                        <a href="#getFilterToMongoDBFormat"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getFilterToMongoDBFormat(filters: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, ignore?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1021"
                                    class="link-to-prism">src/modules/car/car.service.ts:1021</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Converts filter criteria to MongoDB-compatible format for aggregation queries.</p>
<p>This function processes a set of filters and converts them into a format suitable
for MongoDB aggregation pipelines. It handles various types of filters including
single-value filters, range filters (for year, mileage, and price), and multi-select filters.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">             and the value can be a string, an array of strings, or an array of objects.
            This is useful for excluding certain filters in specific contexts.
     Each stage is typically a `$match` operation corresponding to a filter criterion.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filters</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An object containing filter criteria. Each key represents a filter field,
and the value can be a string, an array of strings, or an array of objects.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ignore</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                            <td>
                                                    <ul>
<li>Optional. A string indicating a filter key to ignore during processing.
This is useful for excluding certain filters in specific contexts.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>{}</code>

                        </div>
                            <div class="io-description">
                                <p>An array of MongoDB aggregation pipeline stages representing the processed filters.
Each stage is typically a <code>$match</code> operation corresponding to a filter criterion.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="increaseCarViewCount"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>increaseCarViewCount</b></span>
                        <a href="#increaseCarViewCount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>increaseCarViewCount(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1335"
                                    class="link-to-prism">src/modules/car/car.service.ts:1335</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Increases the view count of a specific car by one.</p>
<p>This function updates the &#39;user_views&#39; field of a car document in the database,
incrementing it by 1. It&#39;s typically used to track how many times a car listing
has been viewed.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car whose view count should be increased.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the updated car document, or null if no car is found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="manageCarMedia"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>manageCarMedia</b></span>
                        <a href="#manageCarMedia"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>manageCarMedia(carId: Types.ObjectId, createCarMediaDto: <a href="../classes/CreateCarMediaDto.html" target="_self">CreateCarMediaDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1462"
                                    class="link-to-prism">src/modules/car/car.service.ts:1462</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Manages car media by sending media update requests to a message queue.</p>
<p>This function prepares car media data for processing, including adding or removing media,
and sends it to a message queue for asynchronous handling. It&#39;s designed to manage
media operations for car advertisements in a scalable way.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                       This includes details about the media to be added or removed.

                    sending the media update to the queue.

                     has been successfully sent to the queue. The function doesn&#39;t
                     return any value directly.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car whose media is being managed.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>createCarMediaDto</td>
                                            <td>
                                                            <code><a href="../classes/CreateCarMediaDto.html" target="_self" >CreateCarMediaDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>A data transfer object containing the media information to be processed.
This includes details about the media to be added or removed.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves when the media management request
has been successfully sent to the queue. The function doesn&#39;t 
return any value directly.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="manageFavoriteAdvertisement"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>manageFavoriteAdvertisement</b></span>
                        <a href="#manageFavoriteAdvertisement"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>manageFavoriteAdvertisement(id: Types.ObjectId, userId: Types.ObjectId, mode: <a href="../undefineds/FavouriteMode.html" target="_self">FavouriteMode</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1496"
                                    class="link-to-prism">src/modules/car/car.service.ts:1496</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Manages the favorite status of an advertisement for a user.</p>
<p>This function either adds or removes a user&#39;s ID from the &#39;favourite&#39; array
of a car advertisement document, depending on the specified mode.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">          Use FavouriteMode.add to add the user, or any other value to remove.

     return any specific value, but updates the database accordingly.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car advertisement to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the user whose favorite status is being managed.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>mode</td>
                                            <td>
                                                            <code><a href="../miscellaneous/enumerations.html#FavouriteMode" target="_self" >FavouriteMode</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An enum value indicating whether to add or remove the user from favorites.
Use FavouriteMode.add to add the user, or any other value to remove.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves when the operation is complete. The function doesn&#39;t
return any specific value, but updates the database accordingly.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="randomDate"></a>
                    <span class="name">
                        <span ><b>randomDate</b></span>
                        <a href="#randomDate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>randomDate(start: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank">Date</a>, end: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank">Date</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="561"
                                    class="link-to-prism">src/modules/car/car.service.ts:561</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Generates a random date between two given dates.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>start</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The start date of the range.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>end</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The end date of the range.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                        </div>
                            <div class="io-description">
                                <p>A new Date object representing a random date between the start and end dates.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refCarSchema"></a>
                    <span class="name">
                        <span ><b>refCarSchema</b></span>
                        <a href="#refCarSchema"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>refCarSchema()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="85"
                                    class="link-to-prism">src/modules/car/car.service.ts:85</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the reference to the Car schema model.</p>
<p>This function provides access to the Mongoose model for the Car schema,
allowing other parts of the application to perform database operations
on the Car collection.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../classes/Car.html" target="_self" >Model&lt;Car&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The Mongoose model for the Car schema.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="remove"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>remove</b></span>
                        <a href="#remove"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>remove(id: Types.ObjectId)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1519"
                                    class="link-to-prism">src/modules/car/car.service.ts:1519</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Asynchronously removes a car advertisement by sending a removal request to a message queue.</p>
<p>This function prepares a message with the car&#39;s ID and sends it to a dedicated queue
for processing the advertisement removal. It uses a message queue to handle the removal
asynchronously, which can improve system responsiveness and scalability.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                    sending the removal request to the queue.
                     successfully sent to the queue. The function doesn&#39;t return any value directly.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car advertisement to be removed.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves when the removal request has been
successfully sent to the queue. The function doesn&#39;t return any value directly.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="removeWhiteCharacters"></a>
                    <span class="name">
                        <span ><b>removeWhiteCharacters</b></span>
                        <a href="#removeWhiteCharacters"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>removeWhiteCharacters(str: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="341"
                                    class="link-to-prism">src/modules/car/car.service.ts:341</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Removes or replaces various white spaces and special characters from a string.</p>
<p>This function performs the following operations:</p>
<ul>
<li>Converts the string to lowercase</li>
<li>Trims leading and trailing whitespace</li>
<li>Replaces multiple spaces with a single underscore</li>
<li>Removes or replaces various special characters (!, |, ,, -, &amp;, /, *)</li>
</ul>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>str</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The input string to be processed</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                <p>A cleaned string with removed/replaced characters and spaces</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="scrapCarAddData"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>scrapCarAddData</b></span>
                        <a href="#scrapCarAddData"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>scrapCarAddData()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="131"
                                    class="link-to-prism">src/modules/car/car.service.ts:131</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Scrapes car data and adds it to the database.</p>
<p>This function processes an array of scraped car data, extracts relevant information,
and adds new car entries to the database. It also updates various filters based on
the scraped data.</p>
<p>The function performs the following main operations:</p>
<ol>
<li>Iterates through scraped car data</li>
<li>Extracts and processes various car attributes (make, model, trim, colors, etc.)</li>
<li>Updates filters if new attribute values are found</li>
<li>Constructs a detailed car object</li>
<li>Checks for duplicate entries</li>
<li>Creates a new car entry if it doesn&#39;t already exist</li>
</ol>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;any[]&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves to an array of processed car details</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="scrapCarAddDataStatic"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>scrapCarAddDataStatic</b></span>
                        <a href="#scrapCarAddDataStatic"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>scrapCarAddDataStatic()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="363"
                                    class="link-to-prism">src/modules/car/car.service.ts:363</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Scrapes car data and adds it to the database.</p>
<p>This function processes an array of scraped car data, extracts relevant information,
and adds new car entries to the database. It also updates various filters based on
the scraped data.</p>
<p>The function performs the following main operations:</p>
<ol>
<li>Iterates through scraped car data</li>
<li>Extracts and processes various car attributes (make, model, trim, colors, etc.)</li>
<li>Updates filters if new attribute values are found</li>
<li>Constructs a detailed car object</li>
<li>Checks for duplicate entries</li>
<li>Creates a new car entry if it doesn&#39;t already exist</li>
</ol>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;any[]&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves to an array of processed car details</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sleepDelay"></a>
                    <span class="name">
                        <span ><b>sleepDelay</b></span>
                        <a href="#sleepDelay"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>sleepDelay(ms: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="325"
                                    class="link-to-prism">src/modules/car/car.service.ts:325</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a delay in the execution of asynchronous code.</p>
<p>This function returns a Promise that resolves after a specified amount of time,
effectively pausing the execution of an async function.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ms</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>2000</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The number of milliseconds to delay. Defaults to 2000 (2 seconds).</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves after the specified delay.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="update"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>update</b></span>
                        <a href="#update"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>update(id: Types.ObjectId, updateCarDto: UpdateCarDto | any)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1424"
                                    class="link-to-prism">src/modules/car/car.service.ts:1424</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates a car document in the database.</p>
<p>This function finds a car by its ID and updates it with the provided data.
It uses MongoDB&#39;s findByIdAndUpdate method to perform the update operation.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                  It can be either of type UpdateCarDto or any other object.
     If no document is found with the given id, it returns null.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateCarDto</td>
                                            <td>
                                                        <code>UpdateCarDto | any</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An object containing the fields to be updated. 
It can be either of type UpdateCarDto or any other object.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the updated car document.
If no document is found with the given id, it returns null.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateAllCount"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateAllCount</b></span>
                        <a href="#updateAllCount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateAllCount()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="626"
                                    class="link-to-prism">src/modules/car/car.service.ts:626</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the count of all filters based on the current car data.</p>
<p>This function retrieves all filters and cars, then iterates through each car
to update the count of matching filters. It handles different filter types
(checkbox, textbox-list, multi-select, multi-choice) and updates their counts
accordingly. A delay of 1 second is applied between processing each car to
prevent overwhelming the system.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves when all filter counts have been updated.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateByQueue"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateByQueue</b></span>
                        <a href="#updateByQueue"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateByQueue(id: Types.ObjectId, updateCarDto: <a href="../classes/Car.html" target="_self">Car</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1352"
                                    class="link-to-prism">src/modules/car/car.service.ts:1352</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates a car record asynchronously using a message queue.</p>
<p>This function prepares the update data, sends it to a message queue for processing,
and then retrieves the updated car record. It&#39;s designed to handle car updates
in a distributed system, allowing for better scalability and fault tolerance.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     includes all fields of the car, potentially with populated related data.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateCarDto</td>
                                            <td>
                                                            <code><a href="../classes/Car.html" target="_self" >Car</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>A Car object containing the updated car information.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the updated car record. The returned object
includes all fields of the car, potentially with populated related data.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateCarMedia"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateCarMedia</b></span>
                        <a href="#updateCarMedia"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateCarMedia(createMediaPositionDTO: <a href="../classes/CreateMediaPositionDTO.html" target="_self">CreateMediaPositionDTO</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1403"
                                    class="link-to-prism">src/modules/car/car.service.ts:1403</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the position of a specific media item for a car.</p>
<p>This function updates the position of a media item (such as an image or video)
associated with a car record in the database. It uses the provided DTO to
identify the car, the specific media item, and its new position.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     This typically includes information about whether the update was successful
     and how many documents were modified.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createMediaPositionDTO</td>
                                            <td>
                                                            <code><a href="../classes/CreateMediaPositionDTO.html" target="_self" >CreateMediaPositionDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Data Transfer Object containing media update information.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the result of the update operation.
This typically includes information about whether the update was successful
and how many documents were modified.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateCarMediaPosition"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateCarMediaPosition</b></span>
                        <a href="#updateCarMediaPosition"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateCarMediaPosition(createMediaPositionDTO: <a href="../classes/CreateMediaPositionDTO.html" target="_self">CreateMediaPositionDTO</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1377"
                                    class="link-to-prism">src/modules/car/car.service.ts:1377</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the position of car media in the advertisement queue.</p>
<p>This function prepares the media position update data and sends it to a message queue
for asynchronous processing. It&#39;s designed to handle updates to the position of media
(like images or videos) associated with a car advertisement.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                            This should include details like the car ID, media type, and new position.
                    sending the update to the queue.
                     sent to the queue. The function doesn&#39;t return any value directly.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createMediaPositionDTO</td>
                                            <td>
                                                            <code><a href="../classes/CreateMediaPositionDTO.html" target="_self" >CreateMediaPositionDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Data transfer object containing the media position update information.
This should include details like the car ID, media type, and new position.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A promise that resolves when the update has been successfully
sent to the queue. The function doesn&#39;t return any value directly.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateDataTrim"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateDataTrim</b></span>
                        <a href="#updateDataTrim"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateDataTrim()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="734"
                                    class="link-to-prism">src/modules/car/car.service.ts:734</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the trim data by associating each trim with its corresponding car model.</p>
<p>This function retrieves all filters, finds the &#39;trim&#39; filter, and then for each trim data,
it searches for an existing car with that trim. If found, it adds the car&#39;s model to the
trim data. Finally, it updates the &#39;trim&#39; filter with the new data that includes the
associated car models.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     The object has a &#39;success&#39; property set to true if the update was successful.</code></pre></div></div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an object indicating the success of the operation.
The object has a &#39;success&#39; property set to true if the update was successful.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStatus"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateStatus</b></span>
                        <a href="#updateStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStatus(id: Types.ObjectId, updateCarDto: <a href="../classes/UpdateCarDto.html" target="_self">UpdateCarDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="1440"
                                    class="link-to-prism">src/modules/car/car.service.ts:1440</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates the status of a car document in the database.</p>
<p>This function finds a car by its ID and updates its status with the provided value.
It uses MongoDB&#39;s findByIdAndUpdate method to perform the update operation.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">                  Only the &#39;status&#39; field from this object is used for the update.
     If no document is found with the given id, it returns null.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                        <code>Types.ObjectId</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ObjectId of the car to be updated.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateCarDto</td>
                                            <td>
                                                            <code><a href="../classes/UpdateCarDto.html" target="_self" >UpdateCarDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>A data transfer object containing the updated car information.
Only the &#39;status&#39; field from this object is used for the update.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to the updated car document.
If no document is found with the given id, it returns null.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyVINNumber"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>verifyVINNumber</b></span>
                        <a href="#verifyVINNumber"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyVINNumber(verifyVinDTO: <a href="../classes/VerifyVinDTO.html" target="_self">VerifyVinDTO</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="696"
                                    class="link-to-prism">src/modules/car/car.service.ts:696</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Verifies a Vehicle Identification Number (VIN) and retrieves detailed vehicle information.</p>
<p>This function decodes the provided VIN number using an external service and extracts
relevant vehicle details. If the VIN is valid and information is available, it returns
a structured object with vehicle specifications. If the VIN is invalid or no information
is found, it returns a failure response.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-none">     or a success flag set to false if the VIN is invalid or no data is found.</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>verifyVinDTO</td>
                                            <td>
                                                            <code><a href="../classes/VerifyVinDTO.html" target="_self" >VerifyVinDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>An object containing the VIN number to be verified.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves to an object with a success flag and vehicle data if successful,
or a success flag set to false if the VIN is invalid or no data is found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="channelWrapper"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>channelWrapper</b></span>
                        <a href="#channelWrapper"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>ChannelWrapper</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="56" class="link-to-prism">src/modules/car/car.service.ts:56</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { HttpException, HttpStatus, Inject, Injectable, forwardRef } from &#x27;@nestjs/common&#x27;;
// import { CreateCarDto } from &#x27;./dto/create-car.dto&#x27;;
import { UpdateCarDto } from &#x27;./dto/update-car.dto&#x27;;
import { CreateCarMediaDto } from &#x27;./dto/media-car.dto&#x27;;
import { CreateMediaPositionDTO } from &#x27;./dto/create-media-position.dto&#x27;;
import { CreateUserFilterDto } from &#x27;./dto/create-user-filter.dto&#x27;;

// aws s3 service
import { AwsS3Service, MediaType } from &#x27;../../utilities/services/aws_s3/aws_s3.service&#x27;;

// mongoose
import { Car } from &#x27;./schema/car.schema&#x27;;
import mongoose, { Model, Types } from &#x27;mongoose&#x27;;
import { InjectModel } from &#x27;@nestjs/mongoose&#x27;;

// queue add &amp; remove media parallel, Manage filter operations(increment, decrement)
import amqp, { ChannelWrapper } from &#x27;amqp-connection-manager&#x27;;
import { Channel } from &#x27;amqplib&#x27;;
import { config } from &#x27;../../utilities/config&#x27;;
import { ICurrentUser } from &#x27;../user/decorator/current-user.decorator&#x27;;

// redis to count car
import { RedisService } from &#x27;../../utilities/services/redis/redis.service&#x27;;

// dayjs
import * as dayjs from &#x27;dayjs&#x27;;

// verify vin
import { VerifyVinDTO } from &#x27;./dto/verify-vin.dto&#x27;;
import { DecodeVinValues } from &#x27;@shaggytools/nhtsa-api-wrapper&#x27;;

// fetch user store
import { UserService } from &#x27;../user/user.service&#x27;;
import { UserRole } from &#x27;../user/schema/user.schema&#x27;;
import { FavouriteMode } from &#x27;../user/dto/manage-user-favourite.dto&#x27;;

// http module
import { HttpService } from &#x27;@nestjs/axios&#x27;;
import { lastValueFrom } from &#x27;rxjs&#x27;;

// scrap filter
import { FilterService } from &#x27;../filter/filter.service&#x27;;
import { Filter, labelValue, labelValueJoin } from &#x27;../filter/schema/filter.schema&#x27;;

// random word
import { generateSlug } from &quot;random-word-slugs&quot;;
import { FindCarStoreDTO } from &#x27;./dto/store-car-find.dto&#x27;;

// scrap file
// import { data } from &#x27;../car/data&#x27;;
import { data as Data_Details } from &#x27;../car/trim.data&#x27;;

@Injectable()
export class CarService {

    private readonly channelWrapper: ChannelWrapper;

    constructor(
        @Inject(forwardRef(() &#x3D;&gt; UserService))
        private readonly userService: UserService,
        private readonly httpService: HttpService,
        private readonly awsS3Service: AwsS3Service,
        @Inject(forwardRef(() &#x3D;&gt; FilterService))
        private readonly filterService: FilterService,
        @InjectModel(Car.name) private readonly carSchema: Model&lt;Car&gt;,
        private readonly redisService: RedisService
    ) {
        const connection &#x3D; amqp.connect([config.RABBITMQ_CAR_URL]);
        this.channelWrapper &#x3D; connection.createChannel({
            setup: (channel: Channel) &#x3D;&gt; {
                return channel.assertQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME, { durable: true });
            },
        });
    }

    /**
     * Retrieves the reference to the Car schema model.
     * 
     * This function provides access to the Mongoose model for the Car schema,
     * allowing other parts of the application to perform database operations
     * on the Car collection.
     * 
     * @returns {Model&lt;Car&gt;} The Mongoose model for the Car schema.
     */
    refCarSchema(): Model&lt;Car&gt; {
        return this.carSchema;
    }

    /**
     * Creates a new car advertisement and adds it to a queue for processing.
     * 
     * This function generates a unique ID for the car, sets it as the stock number,
     * assigns the creator, and then sends the car data to a queue for further processing.
     * 
     * @param createCar - The car object containing all the details of the car to be advertised.
     * @param user - The current user object, containing information about the user creating the advertisement.
     * @returns A Promise that resolves to the generated ID (stock number) of the created car advertisement.
     * @throws {HttpException} If there&#x27;s an error while adding the car to the queue.
     */
    async create(createCar: Car, user: ICurrentUser): Promise&lt;string&gt; {
        const id &#x3D; String(new mongoose.mongo.ObjectId()); // set id in dto because when process in queue we need id to update record
        createCar.stock_number &#x3D; id;
        createCar.createdBy &#x3D; user._id // check who is creating car advertisement
        const queueBody &#x3D; JSON.stringify({ mode: config.QUEUE_ADVERTISEMENT_TOPIC_ADD_ADVERTISEMENT, data: createCar });
        try {
            await this.channelWrapper.sendToQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME, Buffer.from(queueBody), { persistent: true, });
        } catch (error) {
            throw new HttpException(&#x27;Error adding during car, Kindly try again&#x27;, HttpStatus.INTERNAL_SERVER_ERROR);
        }
        return id;
    }

    /**
     * Scrapes car data and adds it to the database.
     * 
     * This function processes an array of scraped car data, extracts relevant information,
     * and adds new car entries to the database. It also updates various filters based on
     * the scraped data.
     * 
     * The function performs the following main operations:
     * 1. Iterates through scraped car data
     * 2. Extracts and processes various car attributes (make, model, trim, colors, etc.)
     * 3. Updates filters if new attribute values are found
     * 4. Constructs a detailed car object
     * 5. Checks for duplicate entries
     * 6. Creates a new car entry if it doesn&#x27;t already exist
     * 
     * @returns {Promise&lt;any[]&gt;} A promise that resolves to an array of processed car details
     * @throws {Error} If there&#x27;s an issue with data processing or database operations
     */
    async scrapCarAddData(): Promise&lt;any[]&gt; {
        const arrCarScrapData &#x3D; [];
        const filters &#x3D; await this.filterService.findAllForAdmin();
        const arrTemp &#x3D; [];
        for (const [index, car] of arrCarScrapData.entries()) {
            if (index &lt; 1897) {
                continue
            }
            const randomIndex &#x3D; Math.floor(Math.random() * index);
            const vin_number &#x3D; [&quot;WA1C4AFYXK2008063&quot;, &quot;WDDHF8JB3EA888654&quot;, &quot;WP1AF2A5XHLB61599&quot;, &quot;55SWF6EB5GU156261&quot;, &quot;W1N4M4HB5MW082662&quot;, &quot;4T1K61AK8NU075327&quot;, &quot;7SAYGDEE0NF377921&quot;, &quot;WDDWK4KB8HF580946&quot;, &quot;WP0AA2A94HS108390&quot;, &quot;SJAAM2ZV7MC036356&quot;, &quot;3VW447AUXJM269778&quot;, &quot;WAUCUGFF5K1011074&quot;, &quot;5UXCR6C06M9E98970&quot;, &quot;WDDUF8FB4GA224017&quot;, &quot;3CZRZ2H5XPM101234&quot;, &quot;WDDTG5CB7JJ483474&quot;, &quot;WP1AB2A52FLB68636&quot;, &quot;ZFF68NHA7D0195597&quot;, &quot;WUASUAFG0EN002402&quot;, &quot;WDDZF4KB6KA513168&quot;, &quot;WDCTG4GB9LJ678584&quot;, &quot;W1N0G8EB7MV318056&quot;, &quot;1FM5K8FH4KGA33682&quot;]
            const seating_capacity &#x3D; (filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;seating_capacity&#x27;).data[randomIndex] as labelValue);
            const home_services &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;home_services&#x27;).data;
            const features &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;features&#x27;).data;
            const store &#x3D; [&#x27;6670876604369d2393366cfa&#x27;, &#x27;6671f498da977f269ea0cdea&#x27;, &#x27;66bf803627bb91ef01689a9a&#x27;];
            const seller_type &#x3D; index % 5 &#x3D;&#x3D;&#x3D; 0 ? &#x27;private_person&#x27; : &#x27;dealer&#x27;;

            // find make
            const make &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;make&#x27;).data.find((flt: any) &#x3D;&gt; flt.label &#x3D;&#x3D;&#x3D; car.hero.make) as labelValue)?.value;
            if (!make) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;make&#x27;)._id, { label: car.hero.make, value: this.removeWhiteCharacters(car.hero.make), count: 0 });
            }

            // find model
            const model &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;model&#x27;).data.find((flt: any) &#x3D;&gt; flt.label &#x3D;&#x3D;&#x3D; car.hero.model) as labelValue)?.value;
            if (!model) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;model&#x27;)._id, { label: car.hero.model, value: this.removeWhiteCharacters(car.hero.model), join: this.removeWhiteCharacters(car.hero.make), count: 0 });
            }

            // find trim
            const trim &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;trim&#x27;).data.find((flt: any) &#x3D;&gt; flt.label &#x3D;&#x3D;&#x3D; (car.hero.trim ? car.hero.trim : &#x27;Unknown&#x27;)) as labelValue)?.value;
            const DataTrim &#x3D; Data_Details.find((data: any) &#x3D;&gt; data.label &#x3D;&#x3D;&#x3D; car.hero.make)?.models.find((data: any) &#x3D;&gt; data.label &#x3D;&#x3D;&#x3D; car.hero.model)?.trims.map((data: any) &#x3D;&gt; { return data.label }).includes(car.hero.trim);
            if (!trim) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;trim&#x27;)._id, { label: DataTrim ? car.hero.trim : &quot;Unknown&quot;, value: DataTrim ? this.removeWhiteCharacters(car.hero.trim) : &quot;unknown&quot;, count: 0 });
            }

            // find interior color 
            const valueColor &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Interior Colour&#x27;)?.value ?? &#x27;Black&#x27;;
            const color &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;color&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueColor) as any)?.value;
            if (!color) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;color&#x27;)._id, { label: valueColor, value: this.removeWhiteCharacters(valueColor), count: 0 });
            }

            // find exterior color 
            const valueExteriorColor &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Exterior Colour&#x27;)?.value ?? &#x27;Unknown&#x27;;
            const exteriorColor &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;exterior_color&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueExteriorColor) as any)?.value;
            if (!exteriorColor) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;exterior_color&#x27;)._id, { label: valueExteriorColor, value: this.removeWhiteCharacters(valueExteriorColor), count: 0 });
            }

            // find doors 
            const valueDoors &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Doors&#x27;)?.value ?? &#x27;4&#x27;;
            const doors &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;doors&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.value &#x3D;&#x3D;&#x3D; valueDoors) as any)?.value;
            if (!doors) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;doors&#x27;)._id, { label: &#x60;${valueDoors} Doors&#x60;, value: valueDoors, count: 0 });
            }

            // find tranmission 
            const valueTransmission &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Transmission&#x27;)?.value;
            const transmission &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;transmission&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueTransmission) as any)?.value;
            if (!transmission) {
                const is_trans &#x3D; valueTransmission ? &#x27;Automatic&#x27;.includes(valueTransmission) ? &#x27;Automatic&#x27; : &#x27;Manual&#x27;.includes(valueTransmission) ? &#x27;Manual&#x27; : &#x27;Unknown&#x27; : &#x27;Unknown&#x27;;
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;transmission&#x27;)._id, { label: is_trans, value: this.removeWhiteCharacters(is_trans), count: 0 });
            }

            // find body type 
            const valueBodyType &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Body Type&#x27;)?.value ?? &#x27;SUV&#x27;;
            const body_type &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;body_type&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueBodyType) as any)?.value;
            if (!body_type) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;body_type&#x27;)._id, { label: valueBodyType, value: this.removeWhiteCharacters(valueBodyType), count: 0 });
            }

            // find drivetrain 
            const valueDrivetrain &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Drivetrain&#x27;)?.value ?? &#x27;FWD&#x27;;
            const drivetrain &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;drivetrain&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueDrivetrain) as any)?.value;
            if (!drivetrain) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;drivetrain&#x27;)._id, { label: valueDrivetrain.toUpperCase(), value: this.removeWhiteCharacters(valueDrivetrain), count: 0 });
            }

            // find fuel type 
            const valueFuelType &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Fuel Type&#x27;)?.value ?? &#x27;Unknown&#x27;;
            const fuel_type &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;fuel_type&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueFuelType) as any)?.value;
            if (!fuel_type) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;fuel_type&#x27;)._id, { label: valueFuelType, value: this.removeWhiteCharacters(valueFuelType), count: 0 });
            }

            // find engine 
            const valueEngine &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Engine&#x27;)?.value;
            const engine &#x3D; (filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;engine&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; valueEngine) as any)?.value;
            const DataEngine &#x3D; Data_Details.find((data: any) &#x3D;&gt; data.label &#x3D;&#x3D;&#x3D; car.hero.make)?.models.find((data: any) &#x3D;&gt; data.label &#x3D;&#x3D;&#x3D; car.hero.model)?.engines.map((data: any) &#x3D;&gt; { return data.label }).includes(valueEngine);
            if (!engine) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;engine&#x27;)._id, { label: DataEngine ? valueEngine : &#x27;Unknown&#x27;, value: DataEngine ? this.removeWhiteCharacters(valueEngine) : &#x27;unknown&#x27;, count: 0 });
            }

            // seating capcity
            if (!seating_capacity) {
                await this.filterService.addFilterData(filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;seating_capacity&#x27;)._id, { label: &#x27;4 Seats&#x27;, value: &#x27;4&#x27;, count: 0 });
            }

            const carDetail: any &#x3D; {
                category: &#x27;car&#x27;,
                make: make ?? this.removeWhiteCharacters(car.hero.make),
                model: model ?? this.removeWhiteCharacters(car.hero.model),
                trim: DataTrim ? this.removeWhiteCharacters(car.hero.trim) : &#x27;unknown&#x27;,
                year: Number(car.hero.year),
                vin_number: vin_number[randomIndex] ?? &#x27;5UXTS3C51K0Z06076&#x27;,
                condition: (filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;condition&#x27;).data.find((cnd: any) &#x3D;&gt; cnd.label &#x3D;&#x3D;&#x3D; car.hero.status) as any).value ?? &#x27;used&#x27;,
                status: &#x27;live&#x27;,
                seller_type,
                publish_to: &quot;euro_exoti_car&quot;,
                asking_price: Number(car.hero.price.replaceAll(&#x27;,&#x27;, &#x27;&#x27;)),
                sales_price: null,
                msrp: null,
                invoice_price: null,
                retail_price: null,
                wholesale_price: null,
                description: car.description?.description[0]?.description ?? &#x27;Test&#x27;,
                warrenty_description: &#x27;No Warrenty&#x27;,
                odometer: car.hero.mileage?.split(&#x27; &#x27;)[0]?.replaceAll(&#x27;,&#x27;, &#x27;&#x27;) ?? &#x27;58650&#x27;,
                in_stock_date: this.randomDate(new Date(2020, 0, 1), new Date()),
                carafax: car.carfax?.buyCarProofUrl ?? null,
                active: true,
                color: color ?? this.removeWhiteCharacters(valueColor),
                exterior_color: exteriorColor ?? this.removeWhiteCharacters(valueExteriorColor),
                doors: doors ?? valueDoors,
                transmission: transmission ?? this.removeWhiteCharacters(valueTransmission),
                body_type: body_type ?? this.removeWhiteCharacters(valueBodyType),
                drivetrain: drivetrain ?? this.removeWhiteCharacters(valueDrivetrain),
                fuel_type: this.removeWhiteCharacters(valueFuelType),
                engine: DataEngine ? this.removeWhiteCharacters(valueEngine) : &#x27;unknown&#x27;,
                seating_capacity: seating_capacity ? seating_capacity.value : &#x27;4&#x27;,
                home_services: home_services.sort(() &#x3D;&gt; 0.5 - Math.random()).slice(0, 2),
                features: features.sort(() &#x3D;&gt; 0.5 - Math.random()).slice(0, 9),
                videos: [],
                images: car.gallery?.items?.filter((img: any) &#x3D;&gt; img.type &#x3D;&#x3D;&#x3D; &#x27;Photo&#x27;).map((img: any, index: number) &#x3D;&gt; {
                    const name &#x3D; img.photoViewerUrl.split(&#x27;/&#x27;);
                    return {
                        &quot;url&quot;: img.galleryUrl,
                        &quot;name&quot;: name[name.length - 1],
                        &quot;path&quot;: &quot;images/20240726/&quot;,
                        &quot;field&quot;: &quot;images&quot;,
                        &quot;position&quot;: index + 1,
                        &quot;date&quot;: new Date()
                    }
                }),
                taxes_fees: [
                    { &quot;type&quot;: &quot;HST&quot;, &quot;value&quot;: &quot;12&quot;, &quot;mode&quot;: &quot;%&quot; },
                    { &quot;type&quot;: &quot;Interest Rate&quot;, &quot;value&quot;: &quot;18.99&quot;, &quot;mode&quot;: &quot;%&quot; }
                ],
            }

            // fuel economy
            const city_fuel_economy &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;City Fuel Economy&#x27;)?.value;
            const highway_fuel_economy &#x3D; car.specifications.specs.find(clr &#x3D;&gt; clr.key &#x3D;&#x3D;&#x3D; &#x27;Hwy Fuel Economy&#x27;)?.value;
            if (city_fuel_economy) {
                carDetail.city_fuel_economy &#x3D; city_fuel_economy.split(&#x27;L&#x27;)[0];
            }
            if (highway_fuel_economy) {
                carDetail.highway_fuel_economy &#x3D; highway_fuel_economy.split(&#x27;L&#x27;)[0];
            }

            // select store or user by seller type
            if (seller_type &#x3D;&#x3D;&#x3D; &#x27;dealer&#x27;) {
                carDetail.store &#x3D; store[Math.floor(Math.random() * store.length)];
                carDetail.createdBy &#x3D; &#x27;660d995e11ac0f14f07517e1&#x27;;
            } else {
                carDetail.user &#x3D; &#x27;6679e15268d2ad0c27611abc&#x27;;
                carDetail.createdBy &#x3D; &#x27;6679e15268d2ad0c27611abc&#x27;;
            }

            const findCar &#x3D; await this.carSchema.find({ make: carDetail.make, model: carDetail.model, asking_price: carDetail.asking_price, odometer: carDetail.odometer }).exec();
            await this.sleepDelay();
            if (findCar.length &#x3D;&#x3D;&#x3D; 0) {
                this.create(carDetail, {
                    _id: carDetail.createdBy,
                    email: &#x27;&#x27;,
                    role: UserRole.Admin,
                    username: &#x27;&#x27;
                });
                // await this.sleepDelay();
            }
            arrTemp.push(carDetail);
        }
        return arrTemp;
    }

    /**
     * Creates a delay in the execution of asynchronous code.
     * 
     * This function returns a Promise that resolves after a specified amount of time,
     * effectively pausing the execution of an async function.
     *
     * @param ms - The number of milliseconds to delay. Defaults to 2000 (2 seconds).
     * @returns A Promise that resolves after the specified delay.
     */
    sleepDelay(ms &#x3D; 2000) {
        return new Promise((resolve) &#x3D;&gt; setTimeout(resolve, ms));
    }

    /**
     * Removes or replaces various white spaces and special characters from a string.
     * 
     * This function performs the following operations:
     * - Converts the string to lowercase
     * - Trims leading and trailing whitespace
     * - Replaces multiple spaces with a single underscore
     * - Removes or replaces various special characters (!, |, ,, -, &amp;, /, *)
     * 
     * @param str - The input string to be processed
     * @returns A cleaned string with removed/replaced characters and spaces
     */
    removeWhiteCharacters(str: string) {
        return str?.toLowerCase().trim().replace(/ +/g, &#x27;_&#x27;).replaceAll(&#x27;!&#x27;, &#x27;&#x27;).replaceAll(&#x27; | &#x27;, &#x27;&#x27;).replaceAll(&#x27;|&#x27;, &#x27;&#x27;).replaceAll(&#x27;,&#x27;, &#x27;&#x27;).replaceAll(&#x27; - &#x27;, &#x27;&#x27;).replaceAll(&#x27;-&#x27;, &#x27;_&#x27;).replaceAll(&#x27; &amp; &#x27;, &#x27;&#x27;).replaceAll(&#x27; / &#x27;, &#x27;&#x27;).replaceAll(&#x27;/&#x27;, &#x27;_&#x27;).replaceAll(&#x27; * &#x27;, &#x27;&#x27;).replaceAll(&#x27;*&#x27;, &#x27;&#x27;);
    }

    /**
     * Scrapes car data and adds it to the database.
     * 
     * This function processes an array of scraped car data, extracts relevant information,
     * and adds new car entries to the database. It also updates various filters based on
     * the scraped data.
     * 
     * The function performs the following main operations:
     * 1. Iterates through scraped car data
     * 2. Extracts and processes various car attributes (make, model, trim, colors, etc.)
     * 3. Updates filters if new attribute values are found
     * 4. Constructs a detailed car object
     * 5. Checks for duplicate entries
     * 6. Creates a new car entry if it doesn&#x27;t already exist
     * 
     * @returns {Promise&lt;any[]&gt;} A promise that resolves to an array of processed car details
     * @throws {Error} If there&#x27;s an issue with data processing or database operations
     */
    async scrapCarAddDataStatic(): Promise&lt;any[]&gt; {
        const filters &#x3D; await this.filterService.findAllForAdmin();
        const makes &#x3D; filters.find(make &#x3D;&gt; make.name.value &#x3D;&#x3D;&#x3D; &#x27;make&#x27;);
        const arrTemp &#x3D; [];
        for (const [index, make] of makes.data.entries()) {
            let models: any &#x3D; filters.find(model &#x3D;&gt; model.name.value &#x3D;&#x3D;&#x3D; &#x27;model&#x27;).data;
            if (!models || models.length &#x3D;&#x3D;&#x3D; 0) return
            models &#x3D; models.filter((model: labelValueJoin) &#x3D;&gt; model.join &#x3D;&#x3D;&#x3D; (make as labelValue).value)
            for (const [iMO, model] of models.entries()) {
                const randomIndex &#x3D; Math.floor(Math.random() * index);
                const year &#x3D; [2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024]
                const vin_number &#x3D; [&quot;WA1C4AFYXK2008063&quot;, &quot;WDDHF8JB3EA888654&quot;, &quot;WP1AF2A5XHLB61599&quot;, &quot;55SWF6EB5GU156261&quot;, &quot;W1N4M4HB5MW082662&quot;, &quot;4T1K61AK8NU075327&quot;, &quot;7SAYGDEE0NF377921&quot;, &quot;WDDWK4KB8HF580946&quot;, &quot;WP0AA2A94HS108390&quot;, &quot;SJAAM2ZV7MC036356&quot;, &quot;3VW447AUXJM269778&quot;, &quot;WAUCUGFF5K1011074&quot;, &quot;5UXCR6C06M9E98970&quot;, &quot;WDDUF8FB4GA224017&quot;, &quot;3CZRZ2H5XPM101234&quot;, &quot;WDDTG5CB7JJ483474&quot;, &quot;WP1AB2A52FLB68636&quot;, &quot;ZFF68NHA7D0195597&quot;, &quot;WUASUAFG0EN002402&quot;, &quot;WDDZF4KB6KA513168&quot;, &quot;WDCTG4GB9LJ678584&quot;, &quot;W1N0G8EB7MV318056&quot;, &quot;1FM5K8FH4KGA33682&quot;]
                const condition &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;condition&#x27;).data[randomIndex];
                const color &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;color&#x27;).data[randomIndex];
                const transmission &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;transmission&#x27;).data[randomIndex];
                const body_type &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;body_type&#x27;).data[randomIndex];
                const exterior_color &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;exterior_color&#x27;).data[randomIndex];
                const drivetrain &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;drivetrain&#x27;).data[randomIndex];
                const fuel_type &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;fuel_type&#x27;).data[randomIndex];
                const engine &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;engine&#x27;).data[randomIndex];
                const seating_capacity &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;seating_capacity&#x27;).data[randomIndex];
                const doors &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;doors&#x27;).data[randomIndex];
                const trim &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;trim&#x27;).data[randomIndex];
                const home_services &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;home_services&#x27;).data;
                const features &#x3D; filters.find(condition &#x3D;&gt; condition.name.value &#x3D;&#x3D;&#x3D; &#x27;features&#x27;).data;
                const store &#x3D; [&#x27;6670876604369d2393366cfa&#x27;, &#x27;6671f498da977f269ea0cdea&#x27;];
                const seller_type &#x3D; iMO % 2 &#x3D;&#x3D;&#x3D; 0 ? &#x27;dealer&#x27; : &#x27;private_person&#x27;;
                const imgMedia &#x3D; [
                    {
                        name: &#x27;hyundai&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/a2833b6d-59bd-43b5-b861-bf8bfd8bd520.png&quot;,
                            &quot;name&quot;: &quot;a2833b6d-59bd-43b5-b861-bf8bfd8bd520.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:18:36.919Z&quot;
                        }
                    },
                    {
                        name: &#x27;audi&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/73ad3b78-9507-4ec3-b294-724fdb78b200.png&quot;,
                            &quot;name&quot;: &quot;73ad3b78-9507-4ec3-b294-724fdb78b200.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:22:48.571Z&quot;
                        }
                    },
                    {
                        name: &#x27;bmw&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/c431f270-f729-4356-ba6c-3cd252c71440.png&quot;,
                            &quot;name&quot;: &quot;c431f270-f729-4356-ba6c-3cd252c71440.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:24:08.448Z&quot;
                        }
                    },
                    {
                        name: &#x27;mercedes-benz&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/52f8f4f3-bc24-46ae-a059-0f463f0e84fd.png&quot;,
                            &quot;name&quot;: &quot;52f8f4f3-bc24-46ae-a059-0f463f0e84fd.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:25:28.709Z&quot;
                        }
                    },
                    {
                        name: &#x27;nissan&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/30fff72f-aa6f-48fa-b019-809aa61f8e36.png&quot;,
                            &quot;name&quot;: &quot;30fff72f-aa6f-48fa-b019-809aa61f8e36.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:27:05.101Z&quot;
                        }
                    },
                    {
                        name: &#x27;toyota&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/caa28a6c-7e85-4271-b0cc-9425757b5f95.png&quot;,
                            &quot;name&quot;: &quot;caa28a6c-7e85-4271-b0cc-9425757b5f95.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:28:33.510Z&quot;
                        }
                    },
                    {
                        name: &#x27;suzuki&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/c8b98c71-04cd-4b05-995e-95cc96fe7d11.png&quot;,
                            &quot;name&quot;: &quot;c8b98c71-04cd-4b05-995e-95cc96fe7d11.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:34:25.488Z&quot;
                        }
                    },
                    {
                        name: &#x27;kia&#x27;,
                        data: {
                            &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/533d2305-e093-46db-b77e-161298575104.png&quot;,
                            &quot;name&quot;: &quot;533d2305-e093-46db-b77e-161298575104.png&quot;,
                            &quot;path&quot;: &quot;images/20240726/&quot;,
                            &quot;field&quot;: &quot;images&quot;,
                            &quot;position&quot;: 1,
                            &quot;date&quot;: &quot;2024-07-26T20:39:44.840Z&quot;
                        }
                    }
                ];
                const img &#x3D; imgMedia.find(img &#x3D;&gt; img.name &#x3D;&#x3D;&#x3D; (make as labelValue).value);
                console.log(&#x27;make: &#x27;, (make as labelValue).value, &#x27;model: &#x27;, model.value, &#x27;year: &#x27;, year[randomIndex], &#x27;vin: &#x27;, vin_number[randomIndex]);
                const carDetail: any &#x3D; {
                    category: &#x27;car&#x27;,
                    make: (make as labelValue).value,
                    model: model.value,
                    year: year[randomIndex] ?? &#x27;1999&#x27;,
                    vin_number: vin_number[randomIndex] ?? &#x27;5UXTS3C51K0Z06076&#x27;,
                    condition: condition ? (condition as labelValue).value : &#x27;used&#x27;,
                    status: &#x27;live&#x27;,
                    seller_type,
                    publish_to: &quot;euro_exoti_car&quot;,
                    asking_price: Math.floor(Math.random() * (90000 - 5000 + 1)) + 5000,
                    sales_price: null,
                    msrp: Math.floor(Math.random() * (170000 - 10000 + 1)) + 10000,
                    invoice_price: null,
                    retail_price: null,
                    wholesale_price: null,
                    description: generateSlug(250, {
                        format: &quot;title&quot;, categories: {
                            noun: [&quot;transportation&quot;, &quot;technology&quot;],
                        }
                    }),
                    warrenty_description: generateSlug(40, { format: &quot;title&quot; }),
                    odometer: Math.floor(Math.random() * (90000 - 5000 + 1)) + 10000,
                    in_stock_date: this.randomDate(new Date(2020, 0, 1), new Date()),
                    carafax: null,
                    active: true,
                    color: color ? (color as labelValue).value : &#x27;black&#x27;,
                    transmission: transmission ? (transmission as labelValue).value : &#x27;automatic&#x27;,
                    body_type: body_type ? (body_type as labelValue).value : &#x27;sedan&#x27;,
                    exterior_color: exterior_color ? (exterior_color as labelValue).value : &#x27;white&#x27;,
                    drivetrain: drivetrain ? (drivetrain as labelValue).value : &#x27;all_wheel_drive&#x27;,
                    fuel_type: fuel_type ? (fuel_type as labelValue).value : &#x27;gasoline&#x27;,
                    engine: engine ? (engine as labelValue).value : &#x27;4&#x27;,
                    seating_capacity: seating_capacity ? (seating_capacity as labelValue).value : &#x27;5&#x27;,
                    doors: doors ? (doors as labelValue).value : &#x27;4&#x27;,
                    trim: trim ? (trim as labelValue).value : &#x27;24l_gl&#x27;,
                    home_services: home_services.sort(() &#x3D;&gt; 0.5 - Math.random()).slice(0, 2),
                    features: features.sort(() &#x3D;&gt; 0.5 - Math.random()).slice(0, 9),
                    videos: [],
                    images: [img ? img.data : {
                        &quot;url&quot;: &quot;https://mechatronic-cars.s3.ca-central-1.amazonaws.com/images/20240726/a2833b6d-59bd-43b5-b861-bf8bfd8bd520.png&quot;,
                        &quot;name&quot;: &quot;a2833b6d-59bd-43b5-b861-bf8bfd8bd520.png&quot;,
                        &quot;path&quot;: &quot;images/20240726/&quot;,
                        &quot;field&quot;: &quot;images&quot;,
                        &quot;position&quot;: 1,
                        &quot;date&quot;: &quot;2024-07-26T20:18:36.919Z&quot;
                    }],
                    taxes_fees: [
                        { &quot;type&quot;: &quot;HST&quot;, &quot;value&quot;: &quot;12&quot;, &quot;mode&quot;: &quot;%&quot; },
                        { &quot;type&quot;: &quot;Interest Rate&quot;, &quot;value&quot;: &quot;18.99&quot;, &quot;mode&quot;: &quot;%&quot; }
                    ],
                }
                // select store or user by seller type
                if (seller_type &#x3D;&#x3D;&#x3D; &#x27;dealer&#x27;) {
                    carDetail.store &#x3D; store[Math.floor(Math.random() * store.length)];
                    carDetail.createdBy &#x3D; &#x27;660d995e11ac0f14f07517e1&#x27;;
                } else {
                    carDetail.user &#x3D; &#x27;6679e15268d2ad0c27611abc&#x27;;
                    carDetail.createdBy &#x3D; &#x27;6679e15268d2ad0c27611abc&#x27;;
                }
                this.create(carDetail, {
                    _id: carDetail.createdBy,
                    email: &#x27;&#x27;,
                    role: UserRole.Admin,
                    username: &#x27;&#x27;
                })
                arrTemp.push(carDetail);
            }
        }
        return arrTemp;
    }

    /**
     * Generates a random date between two given dates.
     * 
     * @param start - The start date of the range.
     * @param end - The end date of the range.
     * @returns A new Date object representing a random date between the start and end dates.
     */
    randomDate(start: Date, end: Date): Date {
        return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
    }

    /**
     * Updates all car records internally by standardizing their attribute values.
     * 
     * This function retrieves all filters and cars from the database, then iterates through each car
     * (starting from the 11th car) to update its attributes based on predefined filter values.
     * It standardizes the values for color, exterior color, drivetrain, transmission, body type,
     * and fuel type. If a matching value is not found, it sets the attribute to &#x27;unknown&#x27;.
     * After updating each car, it applies a delay of 1 second before processing the next car.
     * 
     * @returns A Promise that resolves when all cars have been updated.
     * @throws Will throw an error if there&#x27;s an issue with database operations or attribute updates.
     */
    async changeAllInternally(): Promise&lt;void&gt; {
        const filters &#x3D; await this.filterService.findAll();
        const cars: any &#x3D; await this.carSchema.find().exec();

        const colors &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;color&#x27;).data.map(clr &#x3D;&gt; clr.value);
        const exterior_color &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;exterior_color&#x27;).data.map(clr &#x3D;&gt; clr.value);
        const drivetrain &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;drivetrain&#x27;).data.map(clr &#x3D;&gt; clr.value);
        const tranmission &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;transmission&#x27;).data.map(clr &#x3D;&gt; clr.value);
        const body_type &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;body_type&#x27;).data.map(clr &#x3D;&gt; clr.value);
        const fuel_type &#x3D; filters.find(clr &#x3D;&gt; clr.name.value &#x3D;&#x3D;&#x3D; &#x27;fuel_type&#x27;).data.map(clr &#x3D;&gt; clr.value);

        for (let [index, car] of cars.entries()) {
            if (index &lt; 10) continue;
            const carCopy &#x3D; JSON.parse(JSON.stringify(car));

            car.color &#x3D; colors.some(str &#x3D;&gt; str.includes(carCopy.color)) ? colors.filter(clr &#x3D;&gt; clr.includes(carCopy.color))[0] : &#x27;unknown&#x27;;
            car.exterior_color &#x3D; exterior_color.some(str &#x3D;&gt; str.indexOf(carCopy.exterior_color)) ? exterior_color.filter(clr &#x3D;&gt; carCopy.exterior_color.split(&#x27;_&#x27;).includes(clr))[0] ?? &#x27;unknown&#x27; : &#x27;unknown&#x27;;
            car.drivetrain &#x3D; drivetrain.some(str &#x3D;&gt; str.includes(carCopy.drivetrain)) ? drivetrain.filter(clr &#x3D;&gt; clr.includes(carCopy.drivetrain))[0] : &#x27;unknown&#x27;;
            car.transmission &#x3D; tranmission.some(str &#x3D;&gt; str.includes(carCopy.transmission)) ? tranmission.filter(clr &#x3D;&gt; clr.includes(carCopy.transmission))[0] : &#x27;unknown&#x27;;
            car.body_type &#x3D; body_type.some(str &#x3D;&gt; str.includes(carCopy.body_type)) ? body_type.filter(clr &#x3D;&gt; clr.includes(carCopy.body_type))[0] : &#x27;unknown&#x27;;
            car.fuel_type &#x3D; fuel_type.some(str &#x3D;&gt; str.includes(carCopy.fuel_type)) ? fuel_type.filter(clr &#x3D;&gt; clr.includes(carCopy.fuel_type))[0] : &#x27;unknown&#x27;;

            await this.carSchema.findByIdAndUpdate(car._id, {
                $set: {
                    color: car.color,
                    exterior_color: car.exterior_color,
                    drivetrain: car.drivetrain,
                    transmission: car.transmission,
                    body_type: car.body_type,
                    fuel_type: car.fuel_type,
                }
            });

            await this.sleepDelay(1000);
        }
    }

    /**
     * Updates the count of all filters based on the current car data.
     * 
     * This function retrieves all filters and cars, then iterates through each car
     * to update the count of matching filters. It handles different filter types
     * (checkbox, textbox-list, multi-select, multi-choice) and updates their counts
     * accordingly. A delay of 1 second is applied between processing each car to
     * prevent overwhelming the system.
     * 
     * @returns A Promise that resolves when all filter counts have been updated.
     * @throws Will throw an error if there&#x27;s an issue with retrieving data or updating filter counts.
     */
    async updateAllCount(): Promise&lt;void&gt; {
        const filters &#x3D; await this.filterService.findAll();
        const cars: any &#x3D; await this.carSchema.find().exec();

        for (let [index, car] of cars.entries()) {
            const carCopy &#x3D; JSON.parse(JSON.stringify(car));

            // get all filters - and increment by 1
            await Promise.allSettled(filters.map(async (filter: Filter) &#x3D;&gt; {
                if (filter.name.value in carCopy &amp;&amp; (filter.type &#x3D;&#x3D;&#x3D; &#x27;checkbox&#x27; || filter.type &#x3D;&#x3D;&#x3D; &#x27;textbox-list&#x27;)) {
                    return await this.filterService.updateFilterCountOnAdd(filter._id, carCopy[filter.name.value]);
                }
                if (filter.name.value in carCopy &amp;&amp; (filter.type &#x3D;&#x3D;&#x3D; &#x27;multi-select&#x27; || filter.type &#x3D;&#x3D;&#x3D; &#x27;multi-choice&#x27;)) {
                    carCopy[filter.name.value].forEach(async (element: labelValue) &#x3D;&gt; {
                        return await this.filterService.updateFilterCountOnAdd(filter._id, element.value as string);
                    })
                }
            }));
            await this.sleepDelay(1000);
        }
    }

    /**
     * Creates a new car entry in the database and updates the car count in Redis.
     * This function is designed to be used in a queue-based system for processing car creations.
     *
     * @param car - An object containing the car details to be saved in the database.
     * @returns A Promise that resolves to the saved car document.
     */
    async createByQueue(car: any): Promise&lt;any&gt; {
        const createdFilter &#x3D; new this.carSchema(car);
        const result &#x3D; await createdFilter.save();
        // add car count in redis 
        const getCarRedis &#x3D; await this.redisService.get(&#x27;all:car&#x27;);
        if (getCarRedis) {
            await this.redisService.increase(&#x27;all:car&#x27;);
        } else {
            this.redisService.set(&quot;all:car&quot;, 1);
        }

        return result;
    }

    /**
     * Creates a pre-signed URL for uploading media to AWS S3.
     * 
     * This function generates a URL that allows for direct upload of media files
     * to the specified S3 bucket without requiring AWS credentials in the client-side code.
     * 
     * @param key - The unique identifier for the file in the S3 bucket.
     * @param type - The type of media being uploaded (e.g., image, video).
     * @returns A Promise that resolves to the pre-signed URL for uploading.
     */
    async createMediaUploadURL(key: string, type: MediaType) {
        return await this.awsS3Service.createUrlForUpload(key, type)
    }

    /**
     * Verifies a Vehicle Identification Number (VIN) and retrieves detailed vehicle information.
     * 
     * This function decodes the provided VIN number using an external service and extracts
     * relevant vehicle details. If the VIN is valid and information is available, it returns
     * a structured object with vehicle specifications. If the VIN is invalid or no information
     * is found, it returns a failure response.
     *
     * @param verifyVinDTO - An object containing the VIN number to be verified.
     * @returns A Promise that resolves to an object with a success flag and vehicle data if successful,
     *          or a success flag set to false if the VIN is invalid or no data is found.
     * @throws {HttpException} Throws an HTTP exception with a &#x27;Not Found&#x27; status if there&#x27;s an error in VIN decoding.
     */
    async verifyVINNumber(verifyVinDTO: VerifyVinDTO): Promise&lt;{ success: boolean; data?: any }&gt; {
        try {
            const response &#x3D; await DecodeVinValues(verifyVinDTO.number)
            if (response &amp;&amp; response.Results.length &gt; 0 &amp;&amp; response.Results[0].ErrorCode &#x3D;&#x3D;&#x3D; &#x27;0&#x27;) {
                const vDetail &#x3D; response.Results[0];
                const data &#x3D; {
                    make: vDetail.Make ? vDetail.Make : &#x27;unknown&#x27;,
                    model: vDetail.Model ? vDetail.Model : &#x27;unknown&#x27;,
                    year: vDetail.ModelYear ? vDetail.ModelYear : &#x27;unknown&#x27;,
                    seats: vDetail.Seats ? vDetail.Seats : &#x27;unknown&#x27;,
                    trim: vDetail.Trim ? vDetail.Trim : &#x27;unknown&#x27;,
                    body_type: vDetail.BodyClass.split(&#x27;/&#x27;)[0].includes(&#x27;SUV&#x27;) ? &#x27;SUV&#x27; : vDetail.BodyClass.split(&#x27;/&#x27;)[0].includes(&#x27;Pickup&#x27;) ? &#x27;pickup_truck&#x27; : vDetail.BodyClass.split(&#x27;/&#x27;)[0] ?? &#x27;unknown&#x27;,
                    vin_number: verifyVinDTO.number,
                    transmission: vDetail.TransmissionStyle ? vDetail.TransmissionStyle : &#x27;unknown&#x27;,
                    fuel_type: vDetail.FuelTypePrimary ? vDetail.FuelTypePrimary : &#x27;unknown&#x27;,
                    engine: vDetail.EngineCylinders ? vDetail.EngineCylinders : &#x27;unknown&#x27;,
                    doors: vDetail.Doors ? vDetail.Doors : &#x27;unknown&#x27;
                }
                return { success: true, data }
            } else {
                return { success: false }
            }
        } catch (error) {
            throw new HttpException(&#x27;Invalid VIN&#x27;, HttpStatus.NOT_FOUND)
        }
    }

    /**
     * Updates the trim data by associating each trim with its corresponding car model.
     * 
     * This function retrieves all filters, finds the &#x27;trim&#x27; filter, and then for each trim data,
     * it searches for an existing car with that trim. If found, it adds the car&#x27;s model to the
     * trim data. Finally, it updates the &#x27;trim&#x27; filter with the new data that includes the
     * associated car models.
     * 
     * @returns A Promise that resolves to an object indicating the success of the operation.
     *          The object has a &#x27;success&#x27; property set to true if the update was successful.
     */
    async updateDataTrim(): Promise&lt;{ success: boolean }&gt; {
        const filters &#x3D; await this.filterService.findAllForAdmin();
        const trim &#x3D; filters.find((filter: any) &#x3D;&gt; filter.name.value &#x3D;&#x3D;&#x3D; &#x27;trim&#x27;);
        const tempData &#x3D; [];
        for (const data of trim.data) {
            const existCar: any &#x3D; await this.carSchema.findOne({ trim: (data as labelValue).value });
            if (existCar) {
                tempData.push({ ...data, join: existCar.model });
            }
        }
        await this.filterService.updateDataByFiltername(&#x27;trim&#x27;, tempData);
        return { success: true };
    }

    /**
     * Retrieves a paginated list of all cars from the database.
     *
     * This function queries the car schema, applies pagination, and excludes 
     * the &#x27;createdAt&#x27; and &#x27;updatedAt&#x27; fields from the results.
     *
     * @param page - The page number for pagination. Defaults to 0.
     * @param limit - The number of items per page. Defaults to 10.
     * @returns A Promise that resolves to an array of car documents.
     */
    async findAll(page: number &#x3D; 0, limit: number &#x3D; 10) {
        return await this.carSchema.find().limit(limit).skip(page * limit).select([&#x27;-createdAt&#x27;, &#x27;-updatedAt&#x27;]).exec();
    }

    /**
     * Retrieves cars associated with stores managed by an admin user.
     *
     * This function first finds the stores associated with the given user ID,
     * then retrieves cars that belong to these stores. The results are paginated.
     *
     * @param userId - The ObjectId of the admin user.
     * @param page - The page number for pagination. Defaults to 0.
     * @param limit - The number of items per page. Defaults to 10.
     * @returns A Promise that resolves to an array of car documents associated with the admin&#x27;s stores.
     *          If no stores are found for the user, it returns an empty array.
     */
    async findAllCarByAdminStore(userId: Types.ObjectId, page: number &#x3D; 0, limit: number &#x3D; 10) {
        // find store by id from user
        const stores &#x3D; (await this.userService.findByID(userId)).store;
        if (stores) {
            // find car by admin stores
            return await this.carSchema.find({ store: { $in: stores } }).limit(limit).skip(page * limit).select([&#x27;-createdAt&#x27;, &#x27;-updatedAt&#x27;]).exec();
        }
        return [];
    }

    /**
     * Retrieves cars for client display with associated store and user information.
     * 
     * This function performs an aggregation pipeline to fetch car data along with related
     * store and user details. It includes pagination and sorting by creation date.
     *
     * @param page - The page number for pagination, starting from 0. Defaults to 0.
     * @param limit - The number of items per page. Defaults to 15.
     * @returns A Promise that resolves to an array of car documents with associated store 
     *          and user information, paginated and sorted by creation date in descending order.
     */
    async findCarForClient(page: number &#x3D; 0, limit: number &#x3D; 15) {
        return await this.carSchema.aggregate([
            {
                $lookup: {
                    from: &quot;stores&quot;,
                    localField: &quot;store&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;store&quot;,
                    pipeline: [{ $project: { remote_services: 1, finance_apr: 1, name: 1, _id: 0, address: 1, location: 1, logo: 1 } }],
                }
            },
            {
                $lookup: {
                    from: &quot;users&quot;,
                    localField: &quot;user&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;user&quot;,
                    pipeline: [{ $project: { address: 1, role: 1, location: 1 } }],
                }
            },
            { $unwind: { path: &#x27;$store&#x27;, preserveNullAndEmptyArrays: true } },
            {
                $lookup: {
                    from: &quot;remoteservices&quot;,
                    localField: &quot;store.remote_services&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;store.remote_services&quot;,
                    pipeline: [{ $project: { alias: 1, _id: 0 } }],
                }
            },
            { $skip: Number(page) * Number(limit) },
            { $limit: Number(limit) }
        ]).sort({ createdAt: -1 });
    }

    /**
     * Retrieves cars for clients based on specified filters and pagination parameters.
     * 
     * This function performs a complex aggregation to fetch car data along with associated store and user information.
     * It applies geospatial queries, filters, and lookups to retrieve relevant car listings.
     * The function also calculates filter counts for dynamic filtering options.
     *
     * @param createUserFilterDto - An object containing filter criteria including location and other car attributes.
     * @param page - The page number for pagination. Defaults to &#x27;0&#x27;.
     * @param list - The number of items per page. Defaults to &#x27;15&#x27;.
     * @returns A Promise that resolves to an object containing:
     *          - data: An array of car documents matching the filter criteria.
     *          - total: The total count of cars matching the filter criteria.
     *          - filters: An array of filter objects with counts for each filter option.
     */
    async findCarForClientByFilter(createUserFilterDto: CreateUserFilterDto, page: string &#x3D; &#x27;0&#x27;, list: string &#x3D; &#x27;15&#x27;) {

        const filters &#x3D; Object.fromEntries(Object.entries(createUserFilterDto).filter(([k]) &#x3D;&gt; ![&#x27;lat&#x27;, &#x27;lng&#x27;, &#x27;distance&#x27;].includes(k)));
        const arrAllAggFilters &#x3D; this.getFilterToMongoDBFormat(filters);

        // get data by query filters
        const data &#x3D; await this.carSchema.aggregate([
            {
                $geoNear: {
                    near: {
                        type: &quot;Point&quot;,
                        coordinates: [createUserFilterDto.lng, createUserFilterDto.lat]
                    },
                    maxDistance: Number(createUserFilterDto.distance) * 1000,
                    spherical: true,
                    distanceField: &quot;locationDistance&quot;
                }
            },
            {
                $match: { active: true, status: &#x27;live&#x27; }
            },
            {
                $lookup: {
                    from: &quot;stores&quot;,
                    localField: &quot;store&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;store&quot;,
                    pipeline: [{ $project: { remote_services: 1, finance_apr: 1, name: 1, _id: 0, address: 1, location: 1, logo: 1 } }],
                }
            },
            {
                $lookup: {
                    from: &quot;users&quot;,
                    localField: &quot;user&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;user&quot;,
                    pipeline: [{ $project: { address: 1, role: 1, location: 1 } }],
                }
            },
            { $unwind: { path: &#x27;$store&#x27;, preserveNullAndEmptyArrays: true } },
            ...arrAllAggFilters,
            {
                $lookup: {
                    from: &quot;remoteservices&quot;,
                    localField: &quot;store.remote_services&quot;,
                    foreignField: &quot;_id&quot;,
                    as: &quot;store.remote_services&quot;,
                    pipeline: [{ $project: { alias: 1, _id: 0 } }],
                }
            },
            {
                $project: {
                    name: 1, condition: 1, odometer: 1, images: 1, videos: 1, store: 1, remote_services: 1,
                    home_services: 1, asking_price: 1, msrp: 1, user: 1, seller_type: 1, description: 1
                }
            },
            // {$sample: { size : Number(list) }},
            // { $sort: { createdAt: -1 } },
            { $skip: Number(page) * Number(list) },
            { $limit: Number(list) }
        ]).sort({ createdAt: -1 });

        // remove all images and take min position value
        data.forEach((car: any) &#x3D;&gt; {
            car.count_image &#x3D; car.images.length;
            car.count_video &#x3D; car.videos.length;
            // find minimum position
            const minValue &#x3D; Math.min(...car.images.map((img: any) &#x3D;&gt; { return img.position }));
            car.images &#x3D; car.images.find((img: any) &#x3D;&gt; img.position &#x3D;&#x3D;&#x3D; minValue);
        })

        // get total records found by query
        const count &#x3D; await this.carSchema.aggregate([
            {
                $geoNear: {
                    near: {
                        type: &quot;Point&quot;,
                        coordinates: [createUserFilterDto.lng, createUserFilterDto.lat]
                    },
                    maxDistance: Number(createUserFilterDto.distance) * 1000,
                    spherical: true,
                    distanceField: &quot;locationDistance&quot;
                }
            },
            {
                $match: { active: true, status: &#x27;live&#x27; }
            },
            ...arrAllAggFilters,
            {
                $count: &quot;total&quot;
            }
        ]);

        // get all dynamic filters
        const allFilters &#x3D; await this.filterService.findAllForAdmin();

        // store make, model and trim by query criteria - dynamically
        const objCount: any &#x3D; [];

        let tempCount &#x3D; {};
        const makeFilter &#x3D; this.getFilterToMongoDBFormat(filters, &#x27;make&#x27;);
        // add make default
        tempCount &#x3D; { ...tempCount, make: [...makeFilter, { $unwind: &#x60;$make&#x60; }, { $sortByCount: &#x60;$make&#x60; }] };

        // check make exist, if then add model
        const isMakeExist &#x3D; Object.keys(filters).includes(&#x27;make&#x27;);
        if (isMakeExist) {
            const modelFilter &#x3D; this.getFilterToMongoDBFormat(filters, &#x27;model&#x27;);
            tempCount &#x3D; { ...tempCount, model: [...modelFilter, { $unwind: &#x60;$model&#x60; }, { $sortByCount: &#x60;$model&#x60; }] };
        }

        // check model exist, if then add trim
        const isModelExist &#x3D; Object.keys(filters).includes(&#x27;model&#x27;);
        if (isModelExist) {
            const trimFilter &#x3D; this.getFilterToMongoDBFormat(filters, &#x27;trim&#x27;);
            tempCount &#x3D; { ...tempCount, trim: [...trimFilter, { $unwind: &#x60;$trim&#x60; }, { $sortByCount: &#x60;$trim&#x60; }] };
        }

        // get other filter counts - not include default filter and remove
        for (const filter of allFilters) {
            if (![&#x27;location&#x27;, &#x27;mileage&#x27;, &#x27;features&#x27;, &#x27;condition&#x27;, &#x27;asking_price&#x27;, &#x27;seller_type&#x27;, &#x27;home_services&#x27;, &#x27;make&#x27;, &#x27;model&#x27;, &#x27;trim&#x27;].includes(String(filter.name.value))) {
                // copy final filter array to prevent from last element filter remove
                const tempFinalFilter &#x3D; JSON.parse(JSON.stringify(arrAllAggFilters));;

                if (filter.name.value !&#x3D;&#x3D; &#x27;year&#x27; &amp;&amp; filter.name.value &#x3D;&#x3D;&#x3D; Object.keys(filters).pop()) {
                    tempFinalFilter.pop();
                }

                if (filter.name.value &#x3D;&#x3D;&#x3D; &#x27;year&#x27;) {
                    tempCount &#x3D; { ...tempCount, [&#x60;${filter.name.value}&#x60;]: [...tempFinalFilter, { $group: { _id: &#x60;$${filter.name.value}&#x60; } }] };
                    continue
                }
                tempCount &#x3D; { ...tempCount, [&#x60;${filter.name.value}&#x60;]: [...tempFinalFilter, { $unwind: &#x60;$${filter.name.value}&#x60; }, { $sortByCount: &#x60;$${filter.name.value}&#x60; }] };
            }
        }

        const resultCount &#x3D; await this.carSchema.aggregate([
            {
                $geoNear: {
                    near: {
                        type: &quot;Point&quot;,
                        coordinates: [createUserFilterDto.lng, createUserFilterDto.lat]
                    },
                    maxDistance: Number(createUserFilterDto.distance) * 1000,
                    spherical: true,
                    distanceField: &quot;locationDistance&quot;
                }
            },
            {
                $match: { active: true, status: &#x27;live&#x27; }
            },
            {
                $facet: tempCount
            }
        ]);

        Object.keys(resultCount[0]).forEach(element &#x3D;&gt; {
            objCount.push({ name: element, count: element &#x3D;&#x3D;&#x3D; &#x27;year&#x27; ? resultCount[0][element].map((year: any) &#x3D;&gt; { return year._id }).sort((a, b) &#x3D;&gt; b - a) : resultCount[0][element] });
        });
        return { data, total: count?.[0] ? count[0].total : 0, filters: objCount }
    }

    /**
     * Converts filter criteria to MongoDB-compatible format for aggregation queries.
     * 
     * This function processes a set of filters and converts them into a format suitable
     * for MongoDB aggregation pipelines. It handles various types of filters including
     * single-value filters, range filters (for year, mileage, and price), and multi-select filters.
     *
     * @param filters - An object containing filter criteria. Each key represents a filter field,
     *                  and the value can be a string, an array of strings, or an array of objects.
     * @param ignore - Optional. A string indicating a filter key to ignore during processing.
     *                 This is useful for excluding certain filters in specific contexts.
     * @returns An array of MongoDB aggregation pipeline stages representing the processed filters.
     *          Each stage is typically a &#x60;$match&#x60; operation corresponding to a filter criterion.
     */
    getFilterToMongoDBFormat(filters: any, ignore?: string) {

        // store in temp array
        const arrAllAggFilters &#x3D; [];

        // get all filter by key from object
        const filterKeys &#x3D; Object.keys(filters);

        // add filter step by step in query
        filterKeys.forEach((key: string) &#x3D;&gt; {

            // remove model from filter for make so we get all model
            if (ignore &amp;&amp; ignore &#x3D;&#x3D;&#x3D; &#x27;make&#x27; &amp;&amp; key &#x3D;&#x3D;&#x3D; &#x27;model&#x27;) return;

            // return filter if it&#x27;s same filter in count query 
            if (ignore &amp;&amp; key &#x3D;&#x3D;&#x3D; ignore) {
                return;
            }

            // only one word to search
            if (typeof filters[key] &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
                arrAllAggFilters.push({ $match: { [key]: filters[key] } });
            }
            // check by or - and - operation (key is array and lit&#x27;s not empty)
            if (Array.isArray(filters[key]) &amp;&amp; filters[key].length &gt; 0) {
                // check filter is for operation &#x3D; object array
                if (key &#x3D;&#x3D;&#x3D; &#x27;year&#x27; || key &#x3D;&#x3D;&#x3D; &#x27;mileage&#x27; || key &#x3D;&#x3D;&#x3D; &#x27;asking_price&#x27;) {
                    const objOperator &#x3D; {};
                    filters[key].forEach((element: any) &#x3D;&gt; {
                        if (element.name.toLowerCase() &#x3D;&#x3D;&#x3D; &#x27;minimum&#x27; &amp;&amp; element.value) {
                            objOperator[&#x27;$gte&#x27;] &#x3D; Number(element.value);
                        }
                        if (element.name.toLowerCase() &#x3D;&#x3D;&#x3D; &#x27;maximum&#x27; &amp;&amp; element.value) {
                            objOperator[&#x27;$lte&#x27;] &#x3D; Number(element.value);
                        }
                    });
                    arrAllAggFilters.push({ $match: { [key &#x3D;&#x3D;&#x3D; &#x27;mileage&#x27; ? &#x27;odometer&#x27; : key]: objOperator } });
                } else {
                    // for string-aarray - multi-select or multi-choice has object array
                    const arrOR &#x3D; [];
                    filters[key].forEach((element: any) &#x3D;&gt; {
                        if (typeof element &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
                            arrOR.push({ [key]: element });
                        } else {
                            const string &#x3D; &#x60;${[key]}.value&#x60;;
                            arrOR.push({ [string]: element.value.toLowerCase() });
                        }
                    });
                    // const opr &#x3D; filters[key].length &#x3D;&#x3D;&#x3D; 1 ? { [key]: filters[key][0] }: { &#x27;$or&#x27;: arrOR };
                    arrAllAggFilters.push({ $match: { $or: arrOR } });
                }
            }
        });
        return arrAllAggFilters;
    }

    /**
     * Finds all cars matching the specified filters for email notifications.
     * 
     * This function processes search filters, applies geolocation-based filtering,
     * and retrieves cars created within the last 24 hours. It also formats the
     * result data for email presentation.
     *
     * @param seachFilters - An array of filter objects containing search criteria.
     *                       Each object should have &#x27;name&#x27; and &#x27;value&#x27; properties.
     * @param code - A string representing the location code for geolocation lookup.
     * @returns A Promise that resolves to an array of car objects. Each car object
     *          contains filtered details including name, odometer, asking price,
     *          a thumbnail image URL, and a link to view more details.
     */
    async findAllCarByFilterForMail(seachFilters: any, code: string) {

        const filters &#x3D; seachFilters.filter((flr: any) &#x3D;&gt; ![&#x27;distance&#x27;].includes(flr.name.toLowerCase()));
        const arrAllAggFilters &#x3D; [];
        filters.forEach((filter: any) &#x3D;&gt; {
            // only one word to search
            if (typeof filter.value &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
                arrAllAggFilters.push({ $match: { [filter.name]: filter.value } });
            }
            // check by or - and - operation (key is array and lit&#x27;s not empty)
            if (Array.isArray(filter.value) &amp;&amp; filter.value.length &gt; 0) {
                // for string-aarray
                const arrOR &#x3D; [];
                filter.value.forEach((element: any) &#x3D;&gt; {
                    if (typeof element &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
                        arrOR.push({ [filter.name]: element });
                    } else {
                        const string &#x3D; &#x60;${[filter.name]}.value&#x60;;
                        arrOR.push({ [string]: element.value.toLowerCase() });
                    }
                });
                arrAllAggFilters.push({ $match: { $or: arrOR } });
            }
        });

        const response: any &#x3D; await lastValueFrom(this.httpService.get(&#x60;https://geogratis.gc.ca/services/geolocation/en/locate?q&#x3D;${code}&#x60;));
        const newLocation &#x3D; {
            lat: response.data[0].geometry.coordinates[1],
            lng: response.data[0].geometry.coordinates[0]
        };

        // date
        const yesterday &#x3D; dayjs().subtract(1, &#x27;days&#x27;).toDate();
        const today &#x3D; dayjs().toDate();

        const data &#x3D; await this.carSchema.aggregate([
            {
                $geoNear: {
                    near: {
                        type: &quot;Point&quot;,
                        coordinates: [newLocation.lng, newLocation.lat]
                    },
                    maxDistance: Number(seachFilters.find((flr: any) &#x3D;&gt; flr.name.toLowerCase() &#x3D;&#x3D;&#x3D; &#x27;distance&#x27;).value) * 1000,
                    spherical: true,
                    distanceField: &quot;locationDistance&quot;
                }
            },
            {
                $match: { active: true, status: &#x27;live&#x27;, createdAt: { $gte: yesterday, $lt: today } }
            },
            ...arrAllAggFilters,
            {
                $project: {
                    name: 1,
                    odometer: 1,
                    asking_price: 1,
                    &#x27;images.urlThumbnail&#x27;: 1,
                    &#x27;images.position&#x27;: 1
                }
            },
            { $sort: { createdAt: -1 } }
        ]);

        // add image by finding position and set manual link for view button
        for (const car of data) {
            const index &#x3D; Math.min(...car.images.map((img: any) &#x3D;&gt; img.position));
            const url &#x3D; car.images.find((img: any) &#x3D;&gt; img.position &#x3D;&#x3D;&#x3D; index);
            car.image &#x3D; url.urlThumbnail;
            delete car.images;
            car.link &#x3D; &#x60;${config.FRONTEND_URL}detail/${car._id}&#x60;;
            delete car._id;
        }

        return data;
    }

    /**
     * Retrieves cars associated with a dealer or user, filtered by status and paginated.
     * 
     * This function searches for cars based on the user&#x27;s role (dealer or regular user),
     * the specified status, and applies pagination. It also filters out cars created
     * within the last 5 minutes.
     *
     * @param user - The current user object containing role information.
     * @param dealerOrUserId - The ObjectId of the dealer or user to find cars for.
     * @param status - The status of the cars to retrieve.
     * @param page - The page number for pagination (0-indexed). Defaults to 0.
     * @param limit - The number of items per page. Defaults to 10.
     * @returns A Promise resolving to an object containing:
     *          - data: An array of car documents matching the criteria.
     *          - count: The total number of matching documents.
     */
    async findCarByDealerORUserID(user: ICurrentUser, dealerOrUserId: Types.ObjectId, status: string, page: number &#x3D; 0, limit: number &#x3D; 10) {
        const fiveMinutes &#x3D; dayjs().subtract(5, &#x27;minutes&#x27;).toDate();
        const data &#x3D; await this.carSchema.find({ [user.role &#x3D;&#x3D;&#x3D; UserRole.Dealer ? &#x27;store&#x27; : &#x27;createdBy&#x27;]: dealerOrUserId, createdAt: { $lte: fiveMinutes }, status }).select([&#x27;-createdAt&#x27;, &#x27;-store&#x27;]).sort({ createdAt: -1 }).limit(limit).skip(page * limit).exec();
        const count &#x3D; await this.carSchema.countDocuments({ [user.role &#x3D;&#x3D;&#x3D; UserRole.Dealer ? &#x27;store&#x27; : &#x27;createdBy&#x27;]: dealerOrUserId, createdAt: { $lte: fiveMinutes }, status });
        return { data, count };
    }

    /**
     * Retrieves cars for client display based on store-specific filters and pagination.
     * 
     * This function searches for cars using the provided store filters, applies pagination,
     * and returns both the matching car data and the total count of matching cars.
     *
     * @param findCarStoreDTO - Data transfer object containing store-specific search criteria.
     * @param page - The page number for pagination, starting from 0. Defaults to 0.
     * @param limit - The number of items per page. Defaults to 10.
     * @returns A Promise that resolves to an object containing:
     *          - data: An array of car documents matching the search criteria.
     *          - total: The total count of cars matching the search criteria.
     */
    async findCarForClientByStore(findCarStoreDTO: FindCarStoreDTO, page: number &#x3D; 0, limit: number &#x3D; 10) {
        // check max_price is exist if not then remove
        if (!findCarStoreDTO.max_price) {
            delete findCarStoreDTO.max_price;
        }

        // find all car by make model max_price
        const data &#x3D; await this.carSchema.find({ ...findCarStoreDTO }).limit(limit).skip(page * limit).exec();
        const count &#x3D; await this.carSchema.countDocuments({ ...findCarStoreDTO }).exec();
        return { data, total: count };
    }

    /**
     * Counts the number of cars associated with a specific store.
     *
     * @param id - The ObjectId of the store to count cars for.
     * @returns A Promise that resolves to the number of cars associated with the specified store.
     */
    async countCarByStoreID(id: Types.ObjectId) {
        // find car by admin stores
        return await this.carSchema.countDocuments({ store: id }).lean();
    }

    /**
     * Counts the number of cars created by a specific user.
     *
     * This function queries the database to count all car documents
     * that were created by the user with the given ID.
     *
     * @param userId - The ObjectId of the user whose cars are to be counted.
     * @returns A Promise that resolves to the number of cars created by the specified user.
     */
    async countCarByUserID(userId: Types.ObjectId) {
        // find car by admin stores
        return await this.carSchema.countDocuments({ createdBy: userId }).lean();
    }

    /**
     * Counts the number of cars associated with all stores of a given user.
     *
     * This function first retrieves all stores associated with the user identified by the given ID.
     * It then counts the number of car documents in the database that are associated with any of these stores.
     *
     * @param id - The ObjectId of the user whose stores&#x27; cars are to be counted.
     * @returns A Promise that resolves to the number of cars associated with all stores of the specified user.
     */
    async countCarByStore(id: Types.ObjectId) {
        // find store by id from user
        const stores &#x3D; (await this.userService.findByID(id)).store;
        // find car by admin stores
        return await this.carSchema.countDocuments({ store: { $in: stores } }).lean();
    }

    /**
     * Retrieves cars associated with a specific user, with pagination.
     *
     * This function queries the database for cars linked to the given user ID,
     * applying pagination based on the provided page number and items per page.
     *
     * @param id - The ObjectId of the user whose cars are to be retrieved.
     * @param page - The page number for pagination, starting from 0. Defaults to 0.
     * @param list - The number of items per page. Defaults to 10.
     * @returns A Promise that resolves to an array of car documents associated with the user,
     *          paginated according to the specified page and list parameters.
     */
    async findCarByUser(id: Types.ObjectId, page: number &#x3D; 0, list: number &#x3D; 10) {
        return await this.carSchema.find({ user: id }).limit(list).skip(list * page).exec();
    }

    /**
     * Retrieves cars associated with a specific store, with pagination.
     * 
     * This function queries the database for cars linked to the given store ID,
     * applying pagination based on the provided page number and items per page.
     * It also returns the total count of cars associated with the store.
     *
     * @param storeId - The ObjectId of the store whose cars are to be retrieved.
     * @param page - The page number for pagination, starting from 0. Defaults to 0.
     * @param list - The number of items per page. Defaults to 10.
     * @returns A Promise that resolves to an object containing:
     *          - data: An array of car documents associated with the store, paginated.
     *          - total: The total count of cars associated with the store.
     */
    async findCarByStore(storeId: Types.ObjectId, page: number &#x3D; 0, list: number &#x3D; 10) {
        const data &#x3D; await this.carSchema.find({ store: storeId }).limit(list).skip(list * page).exec();
        const total &#x3D; await this.carSchema.countDocuments({ store: storeId }).exec();
        return { data, total }
    }

    /**
     * Retrieves a single car document by its ID, populating the associated store information.
     * This function is used for updating or viewing detailed car information.
     *
     * @param carId - The ObjectId of the car to retrieve.
     * @returns A Promise that resolves to the car document with populated store information.
     *          Returns null if no car is found with the given ID.
     */
    async findOneCarForUpdateOrViewByID(carId: Types.ObjectId) {
        return await this.carSchema.findById(carId).populate(&#x27;store&#x27;).exec();
    }

    /**
     * Retrieves a single car document by its ID with specific fields and populated related data.
     * 
     * This function fetches a car document, excluding certain fields and populating
     * related user and store information. It&#x27;s useful for retrieving detailed car
     * information for display purposes.
     *
     * @param carId - The ObjectId of the car to retrieve.
     * @returns A Promise that resolves to the car document with populated user and store information.
     *          The returned document excludes createdAt, updatedAt, user._id, createdBy, and active fields.
     *          It includes populated user data (address, location, phone) and store data
     *          (including remote_services and award image).
     */
    findOneCarByID(carId: Types.ObjectId) {
        return this.carSchema.findById(carId)
            .select([&#x27;-createdAt&#x27;, &#x27;-updatedAt&#x27;, &#x27;-user._id&#x27;, &#x27;-createdBy&#x27;, &#x27;-active&#x27;])
            .populate(&#x27;user&#x27;, { address: 1, location: 1, phone: 1 })
            .populate({ path: &#x27;store&#x27;, populate: [{ path: &#x27;remote_services&#x27; }, { path: &#x27;award&#x27;, select: { &#x27;image&#x27;: 1 } }] })
            .exec();
    }

    /**
     * Increases the view count of a specific car by one.
     * 
     * This function updates the &#x27;user_views&#x27; field of a car document in the database,
     * incrementing it by 1. It&#x27;s typically used to track how many times a car listing
     * has been viewed.
     *
     * @param id - The ObjectId of the car whose view count should be increased.
     * @returns A Promise that resolves to the updated car document, or null if no car is found.
     */
    async increaseCarViewCount(id: Types.ObjectId) {
        return await this.carSchema.findOneAndUpdate({ _id: id }, { $inc: { user_views: 1 } });
    }

    /**
     * Updates a car record asynchronously using a message queue.
     * 
     * This function prepares the update data, sends it to a message queue for processing,
     * and then retrieves the updated car record. It&#x27;s designed to handle car updates
     * in a distributed system, allowing for better scalability and fault tolerance.
     *
     * @param id - The ObjectId of the car to be updated.
     * @param updateCarDto - A Car object containing the updated car information.
     * @returns A Promise that resolves to the updated car record. The returned object
     *          includes all fields of the car, potentially with populated related data.
     * @throws HttpException if there&#x27;s an error sending the update to the queue.
     */
    async updateByQueue(id: Types.ObjectId, updateCarDto: Car) {
        updateCarDto._id &#x3D; id; // set id in dto because when process in queue we need id to update record
        const queueBody &#x3D; JSON.stringify({ mode: config.QUEUE_ADVERTISEMENT_TOPIC_UPDATE_ADVERTISEMENT, data: updateCarDto });
        try {
            await this.channelWrapper.sendToQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME, Buffer.from(queueBody), { persistent: true });
        } catch (error) {
            throw new HttpException(&#x27;Error during updating advertisement, Kindly try again&#x27;, HttpStatus.INTERNAL_SERVER_ERROR);
        }
        return await this.findOneCarForUpdateOrViewByID(id);
    }

    /**
     * Updates the position of car media in the advertisement queue.
     * 
     * This function prepares the media position update data and sends it to a message queue
     * for asynchronous processing. It&#x27;s designed to handle updates to the position of media
     * (like images or videos) associated with a car advertisement.
     *
     * @param createMediaPositionDTO - Data transfer object containing the media position update information.
     *                                 This should include details like the car ID, media type, and new position.
     * @throws {HttpException} Throws an HTTP exception with a 500 status code if there&#x27;s an error
     *                         sending the update to the queue.
     * @returns {Promise&lt;void&gt;} A promise that resolves when the update has been successfully
     *                          sent to the queue. The function doesn&#x27;t return any value directly.
     */
    async updateCarMediaPosition(createMediaPositionDTO: CreateMediaPositionDTO): Promise&lt;void&gt; {
        const queueBody &#x3D; JSON.stringify({ mode: config.QUEUE_ADVERTISEMENT_TOPIC_UPDATE_POSITION_ADVERTISEMENT, data: createMediaPositionDTO });
        try {
            await this.channelWrapper.sendToQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME, Buffer.from(queueBody), { persistent: true });
        } catch (error) {
            throw new HttpException(&#x27;Kindly Try Again&#x27;, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }

    /**
     * Updates the position of a specific media item for a car.
     * 
     * This function updates the position of a media item (such as an image or video)
     * associated with a car record in the database. It uses the provided DTO to
     * identify the car, the specific media item, and its new position.
     *
     * @param createMediaPositionDTO - Data Transfer Object containing media update information.
     * @param createMediaPositionDTO._id - The unique identifier of the car.
     * @param createMediaPositionDTO.field - The field name of the media (e.g., &#x27;images&#x27; or &#x27;videos&#x27;).
     * @param createMediaPositionDTO.name - The name of the specific media item to update.
     * @param createMediaPositionDTO.position - The new position value for the media item.
     * 
     * @returns A Promise that resolves to the result of the update operation.
     *          This typically includes information about whether the update was successful
     *          and how many documents were modified.
     */
    async updateCarMedia(createMediaPositionDTO: CreateMediaPositionDTO) {
        const fieldName &#x3D; createMediaPositionDTO.field + &#x27;.name&#x27;;
        const fieldOperatorName &#x3D; createMediaPositionDTO.field + &#x27;.$.position&#x27;;
        return await this.carSchema.updateOne(
            { _id: createMediaPositionDTO._id, [fieldName]: createMediaPositionDTO.name },
            { $set: { [fieldOperatorName]: createMediaPositionDTO.position } }
        );
    }

    /**
     * Updates a car document in the database.
     * 
     * This function finds a car by its ID and updates it with the provided data.
     * It uses MongoDB&#x27;s findByIdAndUpdate method to perform the update operation.
     *
     * @param id - The ObjectId of the car to be updated.
     * @param updateCarDto - An object containing the fields to be updated. 
     *                       It can be either of type UpdateCarDto or any other object.
     * @returns A Promise that resolves to the updated car document.
     *          If no document is found with the given id, it returns null.
     */
    async update(id: Types.ObjectId, updateCarDto: UpdateCarDto | any) {
        return await this.carSchema.findByIdAndUpdate({ _id: id }, { $set: updateCarDto });
    }

    /**
     * Updates the status of a car document in the database.
     * 
     * This function finds a car by its ID and updates its status with the provided value.
     * It uses MongoDB&#x27;s findByIdAndUpdate method to perform the update operation.
     *
     * @param id - The ObjectId of the car to be updated.
     * @param updateCarDto - A data transfer object containing the updated car information.
     *                       Only the &#x27;status&#x27; field from this object is used for the update.
     * @returns A Promise that resolves to the updated car document.
     *          If no document is found with the given id, it returns null.
     */
    async updateStatus(id: Types.ObjectId, updateCarDto: UpdateCarDto) {
        return await this.carSchema.findByIdAndUpdate({ _id: id }, { $set: { status: updateCarDto.status } });
    }

    /**
     * Manages car media by sending media update requests to a message queue.
     * 
     * This function prepares car media data for processing, including adding or removing media,
     * and sends it to a message queue for asynchronous handling. It&#x27;s designed to manage
     * media operations for car advertisements in a scalable way.
     *
     * @param carId - The ObjectId of the car whose media is being managed.
     * @param createCarMediaDto - A data transfer object containing the media information to be processed.
     *                            This includes details about the media to be added or removed.
     * 
     * @throws {HttpException} Throws an HTTP exception with a 500 status code if there&#x27;s an error
     *                         sending the media update to the queue.
     * 
     * @returns {Promise&lt;void&gt;} A promise that resolves when the media management request
     *                          has been successfully sent to the queue. The function doesn&#x27;t 
     *                          return any value directly.
     */
    async manageCarMedia(carId: Types.ObjectId, createCarMediaDto: CreateCarMediaDto): Promise&lt;void&gt; {
        // set id in dto because when process in queue we need id to update record
        createCarMediaDto.id &#x3D; carId;
        //convert object in string to send in queue
        const queueBody &#x3D; JSON.stringify({ mode: config.QUEUE_ADVERTISEMENT_TOPIC_ADD_REMOVE_MEDIA, data: createCarMediaDto });
        try {
            await this.channelWrapper.sendToQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME,
                Buffer.from(queueBody),
                {
                    persistent: true,
                },
            );
        } catch (error) {
            throw new HttpException(
                &#x60;Upload Faild: ${createCarMediaDto.media.name}&#x60;,
                HttpStatus.INTERNAL_SERVER_ERROR,
            );
        }
    }

    /**
     * Manages the favorite status of an advertisement for a user.
     * 
     * This function either adds or removes a user&#x27;s ID from the &#x27;favourite&#x27; array
     * of a car advertisement document, depending on the specified mode.
     *
     * @param id - The ObjectId of the car advertisement to be updated.
     * @param userId - The ObjectId of the user whose favorite status is being managed.
     * @param mode - An enum value indicating whether to add or remove the user from favorites.
     *               Use FavouriteMode.add to add the user, or any other value to remove.
     * 
     * @returns A Promise that resolves when the operation is complete. The function doesn&#x27;t
     *          return any specific value, but updates the database accordingly.
     */
    async manageFavoriteAdvertisement(id: Types.ObjectId, userId: Types.ObjectId, mode: FavouriteMode) {
        if (mode &#x3D;&#x3D;&#x3D; FavouriteMode.add) {
            // add in favorite
            await this.carSchema.findByIdAndUpdate(id, { $addToSet: { favourite: userId } });
        } else {
            // remove from favorite
            await this.carSchema.findByIdAndUpdate(id, { $pull: { favourite: userId } });
        }
    }

    /**
     * Asynchronously removes a car advertisement by sending a removal request to a message queue.
     * 
     * This function prepares a message with the car&#x27;s ID and sends it to a dedicated queue
     * for processing the advertisement removal. It uses a message queue to handle the removal
     * asynchronously, which can improve system responsiveness and scalability.
     *
     * @param id - The ObjectId of the car advertisement to be removed.
     * @throws {HttpException} Throws an HTTP exception with a 500 status code if there&#x27;s an error
     *                         sending the removal request to the queue.
     * @returns {Promise&lt;void&gt;} A promise that resolves when the removal request has been
     *                          successfully sent to the queue. The function doesn&#x27;t return any value directly.
     */
    async remove(id: Types.ObjectId): Promise&lt;void&gt; {
        const queueBody &#x3D; JSON.stringify({ mode: config.QUEUE_ADVERTISEMENT_TOPIC_REMOVE_ADVERTISEMENT, data: { id: String(id) } });
        try {
            await this.channelWrapper.sendToQueue(config.QUEUE_ADVERTISEMENT_QUEUE_NAME, Buffer.from(queueBody), { persistent: true });
        } catch (error) {
            throw new HttpException(&#x27;Kindly try Again&#x27;, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'CarService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
